"use strict";(self.webpackChunkjakarta_subway=self.webpackChunkjakarta_subway||[]).push([[53154],{10294(e,t,r){r.d(t,{S:()=>a});var s=r(15941),i=r(31633),o=r(20664),n=r(13927);function a(e,t,r){const a=function(e,t,r,s){const a=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],l=s?(0,i.GA)(s)/(0,i.G9)(s):1;return(0,n.lU)(e,(e,t)=>(0,o.j)(e,a(t,0)*l,a(t,1)*l,a(t,2)),r)}(l,e,t,r)?(0,n.Qj)(l):[0,0,1];return Math.abs(a[2])>Math.cos((0,s.kU)(80))?2:Math.abs(a[1])>Math.abs(a[0])?1:0}const l=(0,n.vt)()},40366(e,t,r){r.d(t,{F:()=>p,a:()=>g,b:()=>f});var s,i,o=r(57528),n=r(34761),a=r(13191),l=r(9392),c=r(86955),h=r(23687),u=r(12216),d=r(31432),_=r(2687);class p extends d.Y{constructor(){super(...arguments),this.origin=l.uY}}function f(){const e=new _.N5;return e.attributes.add("position","vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new h.F("proj",e=>e.camera.projectionMatrix),new u.S("view",(e,t)=>(0,n.Tl)(m,t.camera.viewMatrix,e.origin))).main.add((0,c.H)(s||(s=(0,o.A)(["gl_Position = proj * view * vec4(position, 1.0);\ngl_Position.z = min(gl_Position.z, gl_Position.w);"])))),e.fragment.main.add((0,c.H)(i||(i=(0,o.A)(["fragColor = vec4(1., 0., 0., 0.);"])))),e}const m=(0,a.vt)(),g=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:p,build:f},Symbol.toStringTag,{value:"Module"}))},50360(e,t,r){r.d(t,{Pg:()=>l,fz:()=>c,g7:()=>n,zo:()=>a});var s=r(68707),i=(r(97799),r(63331),r(56175));r(91523);const o=new i.D;function n(e,t,r){return o.execute(e,t,r,null)}function a(e,t,r){const i=o.executeMany(new s.S(e),t,r,null);return Array.from(i)}function l(e,t,r){return o.isSimpleAsFeature(e,t,r,null,null)}function c(){return o.supportsCurves()}},73074(e,t,r){r.d(t,{P:()=>R});var s=r(54099),i=r(20664),o=r(9392),n=r(43047),a=r(55855),l=r(45308),c=r(42294),h=r(44815),u=r(18117),d=r(12482),_=r(731),p=r(85746),f=r(1307),m=r(49296),g=r(70667),v=r(29889),y=r(442),w=r(52479);class R extends p.X{constructor(e){var t;super(e),this._attachmentOrigin=(0,u.TH)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new s.bk,this._geometry=null,this._width=1,this._color=(0,a.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,a.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new f.o({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=null===(t=e.attached)||void 0===t||t}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:A,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:A,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,n.a)(e,this._color)||((0,n.d)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,n.a)(e,this._innerColor)||((0,n.d)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,n.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,a.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var e;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=null===(e=this.object3dResources.resources)||void 0===e?void 0:e.geometries;if(!t||0===t.length)return null;(0,i.j)(C,0,0,0);let r=0;for(const s of t)s.computeAttachmentOrigin(b)&&((0,i.g)(C,C,b),r++);return 0===r?null:((0,i.h)(C,C,1/r),this.view.renderCoordsHelper.fromRenderCoords(C,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(this._materialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const s of r)e.addGeometry(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new w.W(this._materialParameters,this.view.state.isGlobal),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r}}_createDrapedResources(){const e=new w.W(this._materialParameters,this.view.state.isGlobal);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,s=r.basemapTerrain.spatialReference;return null==t||null==s?[]:(0,v.A)(t,s).lines.map(t=>{let{position:i}=t;const o={overlayInfo:{spatialReference:s,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:i},removeDuplicateStartEnd:this._isClosed};return new y.$((0,g.te)(e,o))})}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const s=r.attributes.get("position"),i=(0,h.jh)(s.data.length);(0,l.projectBuffer)(s.data,t.spatialReference,0,i,this.view.spatialReference,0),(0,c.Hq)(e,i)}return!0}_createRenderGeometries(e,t){var r;const s=this.geometry;if(null==s)return;const i=(0,v.C)(s,this.view.elevationProvider,this.view.renderCoordsHelper,m.F.fromElevationInfo(null!==(r=this.elevationInfo)&&void 0!==r?r:new _.A({mode:(0,d.w7)(s,null)}))),o=new Array;for(const{position:n,mapPositions:a}of i.lines){const r={mapPositions:a,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push((0,g.te)(e,r)),o.push(n)}this._laserline.pathVerticalPlane=o}}function A(e){e.geometries=[]}const b=(0,o.vt)(),C=(0,o.vt)()},77176(e,t,r){r.d(t,{b:()=>o});var s=r(15941),i=r(38496);function o(e,t,r){var o;const h=Array.isArray(e),u=h?e.length/t:e.byteLength/(4*t),d=h?e:new Uint32Array(e,0,u*t),_=null!==(o=null===r||void 0===r?void 0:r.minReduction)&&void 0!==o?o:0,p=(null===r||void 0===r?void 0:r.originalIndices)||null,f=p?p.length:0,m=(null===r||void 0===r?void 0:r.componentOffsets)||null;let g=0;if(m)for(let s=0;s<m.length-1;s++){const e=m[s+1]-m[s];e>g&&(g=e)}else g=u;const v=Math.floor(1.1*g)+1;(null==c||c.length<2*v)&&(c=new Uint32Array((0,s.cU)(2*v)));for(let s=0;s<2*v;s++)c[s]=0;let y=0;const w=!!m&&!!p,R=w?f:u;let A=(0,i.my)(u);const b=new Uint32Array(f),C=1.96;let O=0!==_?Math.ceil(4*C*C/(_*_)*_*(1-_)):R,G=1,M=m?m[1]:R;for(let s=0;s<R;s++){if(s===O){const e=1-y/s;if(e+C*Math.sqrt(e*(1-e)/s)<_)return null;O*=2}if(s===M){for(let e=0;e<2*v;e++)c[e]=0;if(p)for(let e=m[G-1];e<m[G];e++)b[e]=A[p[e]];M=m[++G]}const e=w?p[s]:s,r=e*t,i=l(d,r,t);let o=i%v,a=y;for(;0!==c[2*o+1];){if(c[2*o]===i){const e=c[2*o+1]-1;if(n(d,r,e*t,t)){a=A[e];break}}o++,o>=v&&(o-=v)}a===y&&(c[2*o]=i,c[2*o+1]=e+1,y++),A[e]=a}if(0!==_&&1-y/u<_)return null;if(w){for(let e=m[G-1];e<b.length;e++)b[e]=A[p[e]];A=(0,i.uW)(b)}const x=h?new Array(y):new Uint32Array(y*t);y=0;for(let s=0;s<R;s++)A[s]===y&&(a(d,(w?p[s]:s)*t,x,y*t,t),y++);if(p&&!w){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=A[p[t]];A=(0,i.uW)(e)}return{buffer:Array.isArray(x)?x:x.buffer,indices:A,uniqueCount:y}}function n(e,t,r,s){for(let i=0;i<s;i++)if(e[t+i]!==e[r+i])return!1;return!0}function a(e,t,r,s,i){for(let o=0;o<i;o++)r[s+o]=e[t+o]}function l(e,t,r){let s=0;for(let i=0;i<r;i++)s=e[t+i]+s|0,s=s+(s<<11)+(s>>>2)|0;return s>>>0}let c=null},80069(e,t,r){r.d(t,{F:()=>_,a:()=>f,b:()=>p});var s,i=r(57528),o=r(75540),n=r(73398),a=r(21390),l=r(86955),c=r(72790),h=r(70367),u=r(31432),d=r(2687);class _ extends u.Y{constructor(){super(...arguments),this.effect=0,this.fadeFactor=(0,o.v)(1)}}function p(){const e=new d.N5;return e.include(n.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new h.N("colorTexture",e=>e.color),new h.N("focusArea",e=>e.focusArea),new c.c("focusAreaEffectMode",e=>e.effect),new a.m("fadeFactor",e=>e.fadeFactor.value)).main.add((0,l.H)(s||(s=(0,i.A)(["\n      float mask = texture( focusArea, uv, 0.0 ).r;\n      vec4 color = texture( colorTexture, uv, 0.0 );\n      vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\n      if (focusAreaEffectMode == ",") {\n        fragColor = mask > 0.0 ? color : mix(color, 0.55 * colorDeSaturate + 0.45, fadeFactor);\n      } else {\n        fragColor = mask > 0.0 ? color : mix(color, 0.33 * color, fadeFactor);\n      }\n  "])),l.H.int(0))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:_,build:p},Symbol.toStringTag,{value:"Module"}))},83457(e,t,r){r.d(t,{fz:()=>a,g7:()=>o,zo:()=>n});var s=r(68707);const i=new(r(20265).O);function o(e,t,r,s){return i.execute(e,t,r,s,null)}function n(e,t,r,o){const n=i.executeMany(new s.S(e),t,r,o,null);return Array.from(n)}function a(){return i.supportsCurves()}},85746(e,t,r){r.d(t,{X:()=>f});var s=r(6326),i=r(91967),o=r(5632),n=r(46053),a=(r(81806),r(76460),r(47249),r(87990));class l{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=2}destroy(){this._destroyResources()}get resources(){var e;return null===(e=this._resources)||void 0===e?void 0:e.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const r=null===(t=this._resources)||void 0===t?void 0:t.layerView;r&&(r.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new c({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!0))}}let c=class extends((0,o.sA)(i.A)){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1,this.renderGroup=2}};(0,s.Cg)([(0,n.MZ)({constructOnly:!0})],c.prototype,"view",void 0),(0,s.Cg)([(0,n.MZ)({readOnly:!0})],c.prototype,"drapeSourceType",void 0),(0,s.Cg)([(0,n.MZ)()],c.prototype,"renderGroup",void 0),c=(0,s.Cg)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],c);var h=r(69230),u=r(68134),d=r(37046),_=r(8918);class p{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t.stage;if(!r)return;const s=new _.x(r,{pickable:!1,updatePolicy:1}),i=new d.B({castShadow:!1}),o=e.createResources(i,s);s.add(i);const n=e.cameraChanged,a=n?(0,u.wB)(()=>t.state.camera,e=>n(e),u.Vh):null;this._resources={layer:s,object:i,external:o,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class f extends h.B{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new p(this.createObject3DResourceFactory(e.view)),this.drapedResources=new l(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){var t,r;null!==(t=this.object3dResources)&&void 0!==t&&t.forEachMaterial(e),null===(r=this.drapedResources)||void 0===r||r.forEachMaterial(e)}}},94522(e,t,r){r.r(t),r.d(t,{FocusAreasView:()=>te});var s=r(6326),i=r(91967),o=r(18690),n=r(19276),a=r(50076),l=r(76460),c=r(43927),h=r(68134),u=r(31633),d=r(46053),_=(r(81806),r(87990)),p=r(38983),f=r(13191),m=r(9392),g=r(34111),v=r(19247),y=r(56611),w=r(83457),R=r(50360),A=r(58067),b=r(5809),C=r(44815),O=r(14556),G=r(38496),M=r(45136),x=r(49296),D=r(16266),P=r(36423),E=r(87925),F=r(89379),S=(r(47249),r(90364)),j=r(36451),V=r(80069),k=r(16506),T=r(59246),H=r(11850),N=r(57162);class q extends T.w{constructor(e,t){super(e,t,new k.$(V.a,()=>r.e(81345).then(r.bind(r,81345))),H.Nx)}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn})}}var W=r(93345);let I=class extends j.A{constructor(e){super((0,F.A)((0,F.A)({},e),{},{view:e.focusAreasView.view})),this.consumes={required:[S.OG.FOCUSAREA_COLOR,S.OG.FOCUSAREA]},this.produces=S.OG.FOCUSAREA_COLOR,this._fadeDirection=0,this._passParameters=new V.F}precompile(){this.techniques.precompile(q)}fadeOut(e){this.removeAllHandles(),this._startTime=null,this._fadeDirection=1,this.addHandles((0,h.wB)(()=>this._passParameters.fadeFactor.value,t=>{0===t&&(this.removeAllHandles(),e())})),this.requestRender(2)}render(e){var t,r,s;const i=this.techniques.get(q),o=e.find(e=>{let{name:t}=e;return t===this.produces});if(!i.compiled)return this.requestRender(1),o;const n=this.focusAreasView.style,a=this.bindParameters,l=a.camera,c=l.fullViewport[2],h=l.fullViewport[3];null!==(t=this._startTime)&&void 0!==t||(this._startTime=null===(r=this.view.stage)||void 0===r?void 0:r.renderer.renderContext.time);const u=this.view.qualitySettings.fadeDuration,d=u>0?Math.min(u,(null===(s=this.view.stage)||void 0===s?void 0:s.renderer.renderContext.time)-this._startTime)/u:1,_=e.find(e=>{let{name:t}=e;return t===S.OG.FOCUSAREA}),p=this.fboCache.acquire(c,h,this.produces),f=this.renderingContext;return f.bindFramebuffer(p.fbo),this._passParameters.color=o.getTexture(),this._passParameters.focusArea=_.getTexture(),this._passParameters.effect=U[n],this._passParameters.fadeFactor.value=0===this._fadeDirection?d:1-d,f.bindTechnique(i,a,this._passParameters),f.screen.draw(),p.attachDepth(o.getAttachment(W.nI)),d<1&&this.requestRender(2),p}};(0,s.Cg)([(0,d.MZ)()],I.prototype,"consumes",void 0),(0,s.Cg)([(0,d.MZ)()],I.prototype,"produces",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],I.prototype,"focusAreasView",void 0),I=(0,s.Cg)([(0,_.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],I);const U={bright:0,dark:1};var z=r(40366),Z=r(75757);class B extends T.w{constructor(e,t){super(e,t,new k.$(z.a,()=>r.e(55698).then(r.bind(r,55698))),(0,Z.Xk)(H.SL))}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn,depthTest:{func:515}})}}var $=r(69008),L=r(31432),X=r(9243);let Y=class extends j.A{constructor(e){super((0,F.A)((0,F.A)({},e),{},{view:e.focusAreasView.view})),this.consumes={required:[S.hM.TRANSPARENT]},this.produces=S.OG.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new z.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(B)}render(e){const t=this.techniques.get(B),r=this.bindParameters,s=r.camera,i=s.fullViewport[2],o=s.fullViewport[3];if(!t.compiled||!this._vaos)return void this.requestRender(1);const n=e.find(e=>{let{name:t}=e;return t===S.hM.TRANSPARENT}),a=this.renderingContext,l=this.fboCache.acquire(i,o,S.OG.FOCUSAREA,2);this.view.stage.renderer.occludedRequiresStencil?(l.acquireDepth(13),a.blitFramebuffer(n.fbo,l.fbo,256)):l.attachDepth(n.getAttachment(W.nI)),a.bindFramebuffer(l.fbo),a.setClearColor(0,0,0,1),a.clear(17408),a.setViewport(0,0,i,o);const c=a.bindTechnique(t,r);a.setFaceCullingEnabled(!1),a.setStencilTestEnabled(!0),a.setStencilOpSeparate(1028,7680,34055,7680),a.setStencilOpSeparate(1029,7680,34056,7680),a.setDepthWriteEnabled(!1);for(let h=0;h<this._vaos.length;h++){const e=this._vaos[h],t=this._counts[h];this._maskParameters.origin=this._origins[h],c.bindDraw(r,L.m,this._maskParameters),a.bindVAO(e),a.setDepthTestEnabled(!0),a.setStencilWriteMask(255),a.setStencilFunction(519,0,255),a.setColorMask(!1,!1,!1,!1),a.drawArrays(W.WR.TRIANGLES,0,t),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),a.setStencilFunction(517,0,255),a.setColorMask(!0,!0,!0,!0),a.drawArrays(W.WR.TRIANGLES,0,t)}return l}updateGeometries(){this.view.stage&&(this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0,this.focusAreasView.volumes.forEach(e=>{const t=new Array;let r=0,s=0;e.geometryVolumes.forEach(e=>{const i=e.indicesBottom;r+=i.length;for(let r=0;r<i.length;r++)t.push(e.positions[3*(i[r]-1)]),t.push(e.positions[3*(i[r]-1)+1]),t.push(e.positions[3*(i[r]-1)+2]);const o=e.indicesExtruded;s+=o.length;for(let r=0;r<o.length;r++)t.push(e.positions[3*o[r]]),t.push(e.positions[3*o[r]+1]),t.push(e.positions[3*o[r]+2])});const i=new $.Z(this.renderingContext,new X.R(this.renderingContext,H.SL,new Float32Array(t)));this._vaos.push(i),this._counts.push(r+s),this._origins.push(e.origin)}),this.requestRender(1))}};(0,s.Cg)([(0,d.MZ)()],Y.prototype,"consumes",void 0),(0,s.Cg)([(0,d.MZ)()],Y.prototype,"produces",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],Y.prototype,"focusAreasView",void 0),Y=(0,s.Cg)([(0,_.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],Y);var Q=r(69539),K=r(30726),J=r(73074);let ee=class extends i.A{constructor(e){super(e)}initialize(){this.addHandles([(0,h.wB)(()=>this.area.enabled,()=>this._ensureElement(),h.Vh),(0,h.wB)(()=>{var e;return null===(e=this.area.outline)||void 0===e?void 0:e.color},e=>this._updateColor(e),h.Vh),(0,h.wB)(()=>this.area.geometries,e=>this._updateGeometries(e),h.Vh)])}destroy(){this.removeAllHandles(),this._outlineElement=(0,K.pR)(this._outlineElement)}_ensureElement(){var e,t,r;this.area.enabled&&null!==(e=this.area.outline)&&void 0!==e&&e.color?null!==(t=this._outlineElement)&&void 0!==t||(this._outlineElement=new J.P({view:this.view,geometry:this._mergePolygons(this.area.geometries),isDraped:!0,attached:!0,isDecoration:!1,color:Q.A.toUnitRGBA(null===(r=this.area.outline)||void 0===r?void 0:r.color),renderOccluded:4,width:3})):this._outlineElement=(0,K.pR)(this._outlineElement)}_updateGeometries(e){this._ensureElement(),this._outlineElement&&(this._outlineElement.geometry=this._mergePolygons(e))}_updateColor(e){this._ensureElement(),this._outlineElement&&e&&(this._outlineElement.color=Q.A.toUnitRGBA(e))}_mergePolygons(e){if(!e||0===e.length)return null;const t=e.at(0).clone();return t.rings.length=0,e.forEach(e=>t.rings.push(...e.rings)),t}};(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],ee.prototype,"view",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],ee.prototype,"area",void 0),ee=(0,s.Cg)([(0,_.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaOutlineItem")],ee);let te=class extends i.A{constructor(e){super(e),this._volumes=new Map,this._elevationContext=new x.F,this._outlineMap=new n.A}initialize(){this.addHandles([(0,h.wB)(()=>{var e;return{polygons:this.polygons,ready:null===(e=this.view.basemapTerrain)||void 0===e?void 0:e.ready}},e=>{let{polygons:t,ready:r}=e;r&&this._updateVolumes(t)},h.Vh)]),this._outlineMap=(0,c.L)(()=>{var e;return null===(e=this.areas)||void 0===e?void 0:e.areas},e=>new ee({area:e,view:this.view}),{recycleItems:!0})}destroy(){this.removeAllHandles(),this._outlineMap.destroy()}get areas(){var e;return null===(e=this.view.map)||void 0===e?void 0:e.focusAreas}get enabledAreas(){var e,t;return null!==(e=null===(t=this.areas)||void 0===t?void 0:t.areas.toArray().filter(e=>{let{enabled:t}=e;return t}))&&void 0!==e?e:[]}get style(){var e,t;return null!==(e=null===(t=this.areas)||void 0===t?void 0:t.style)&&void 0!==e?e:"bright"}get polygons(){return this.enabledAreas.reduce((e,t)=>e.concat(t.geometries.toArray()),new Array)}containsGeometry(e){if(0===this.polygons.length)return!0;const t=new v.A(e);return this.polygons.some(e=>e.contains(t))}_updateVolumes(e){this._extrude(e),this._ensureRenderNodes()}_extrude(e){var t;if(!this.view.renderCoordsHelper||(0,o.aI)(Array.from(this._volumes.keys()),e))return;const r=this.view.renderCoordsHelper,s=(0,m.vt)(),i=1===r.viewingMode,n=(0,f.vt)(),c=(0,f.vt)(),h=this.view.spatialReference,d=(0,A.fromSpatialReference)(h),_=(0,g.tO)(h).radius/O.$O.radius,v=(0,u.UW)(5e5*_,"meters",h,!0);i||r.worldUpAtPosition([0,0,0],s);const x=new Map;for(const o of e){const e=this._volumes.get(o);if(e)x.set(o,e);else try{var F;const e=h.equals(o.spatialReference)?o:(0,y.project)(o,h),t=Math.max(e.extent.width,e.extent.height),a=(0,u.PQ)(t,h,"meters",!0),l=Math.max(5*a,2e4*_),f=i?_/10:_,m=this._reduceGeometryHeight(e,l,f),g=(0,P.W$)(m);if(null==g)continue;const O=(0,A.fromPolygon)(m),S=null!==(F=(0,R.g7)(O,d,!1))&&void 0!==F?F:O,j=(0,w.g7)(S,v,0,0),V=(0,A.toPolygon)(j,h);if(null==V)continue;(0,b.l)(h,[g.x,g.y,0],n,r.spatialReference),c[12]=-n[12],c[13]=-n[13],c[14]=-n[14];const k=(0,E.C8)(V,this.view.elevationProvider,r,this._elevationContext),{polygons:T,mapPositions:H,position:N}=k,q=new Array,W=new re(q,[n[12],n[13],n[14]]);for(const r of T){const e=r.count,t=(0,p.e)(r.mapPositions,r.holeIndices,3);if(0===t.length)continue;const o=t.length,n=6*e,a=n+o,h=(0,C.jh)(3*n),u=(0,G.my)(a),d=(0,G.my)(o);(0,D.K)(N,H,t,r,h,null,null,null,u,d,l,s,i),(0,M.t)(h,h,c);const _=new se(h,d,u,l);q.push(_)}x.set(o,W)}catch(S){l.A.getLogger(this).error(new a.A("focusareasview:projection-failed","Failed to project focus area geometry to view spatial reference",{geometry:o,error:S}))}}this._volumes=x,0!==this.volumes.size&&(null===(t=this._maskRenderNode)||void 0===t||t.updateGeometries())}_ensureRenderNodes(){var e,t;if(this.view.stage)if(0===this.volumes.size){const{_maskRenderNode:e,_colorRenderNode:t}=this;this._maskRenderNode=this._colorRenderNode=null,null===t||void 0===t||t.fadeOut(()=>{null!==e&&void 0!==e&&e.destroy(),null===t||void 0===t||t.destroy()})}else null!==(e=this._maskRenderNode)&&void 0!==e||(this._maskRenderNode=new Y({focusAreasView:this})),null!==(t=this._colorRenderNode)&&void 0!==t||(this._colorRenderNode=new I({focusAreasView:this})),this.view.stage.renderView.requestRender()}_reduceGeometryHeight(e,t,r){const s=-12e5*r,i=Math.max(-t/2,s),o=e.rings.map(e=>e.map(e=>[e[0],e[1],i])),n=e.clone();return n.rings=o,n.hasZ=!0,n}get volumes(){return this._volumes}};(0,s.Cg)([(0,d.MZ)()],te.prototype,"_volumes",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],te.prototype,"view",void 0),te=(0,s.Cg)([(0,_.$)("esri.views.3d.FocusAreasView")],te);class re{constructor(e,t){this.geometryVolumes=e,this.origin=t}}class se{constructor(e,t,r,s){this.positions=e,this.indicesBottom=t,this.indicesExtruded=r,this.height=s}}},99785(e,t,r){r.d(t,{lO:()=>c,oR:()=>h});var s=r(38983),i=r(5262),o=r(44815),n=r(38496),a=r(10294),l=r(77176);function c(e){const t=h(e.rings,e.hasZ,1,e.spatialReference),r=new Array;let i=0,a=0;for(const l of t.polygons){const e=l.count,c=l.index,h=(0,o.l5)(t.position,3*c,3*e),u=l.holeIndices.map(e=>e-c),d=(0,n.uW)((0,s.e)(h,u,3));r.push({position:h,faces:d}),i+=h.length,a+=d.length}const c=function(e,t,r){if(1===e.length)return e[0];const s=(0,o.jh)(t),i=new Array(r);let a=0,l=0,c=0;for(const o of e){for(let e=0;e<o.position.length;e++)s[a++]=o.position[e];for(const e of o.faces)i[l++]=e+c;c=a/3}return{position:s,faces:(0,n.uW)(i)}}(r,i,a),u=Array.isArray(c.position)?(0,l.b)(c.position,3,{originalIndices:c.faces}):(0,l.b)(c.position.buffer,6,{originalIndices:c.faces});return c.position=(0,o.xm)(new Float64Array(u.buffer)),c.faces=u.indices,c}function h(e,t,r,s){const i=e.length,n=new Array(i),a=new Array(i),l=new Array(i);let c=0;for(let o=0;o<i;++o)c+=e[o].length;let h=0,_=0,p=0;const f=(0,o.jh)(3*c);let m=0;for(let o=i-1;o>=0;o--){const c=e[o],g=1===r&&d(c,t,s);if(g&&1!==i)n[h++]=c;else{let e=c.length;for(let t=0;t<h;++t)e+=n[t].length;const r={index:m,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};r.pathLengths[0]=c.length,c.length>0&&(l[p++]={index:m,count:c.length}),m=g?u(c,c.length-1,-1,f,m,c.length,t):u(c,0,1,f,m,c.length,t);for(let s=0;s<h;++s){const e=n[s];r.holeIndices[s]=m,r.pathLengths[s+1]=e.length,e.length>0&&(l[p++]={index:m,count:e.length}),m=u(e,0,1,f,m,e.length,t)}h=0,r.count>0&&(a[_++]=r)}}for(let o=0;o<h;++o){const e=n[o];e.length>0&&(l[p++]={index:m,count:e.length}),m=u(e,0,1,f,m,e.length,t)}return a.length=_,l.length=p,{position:f,polygons:a,outlines:l}}function u(e,t,r,s,i,o,n){i*=3;for(let a=0;a<o;++a){const o=e[t];s[i++]=o[0],s[i++]=o[1],s[i++]=n&&o[2]?o[2]:0,t+=r}return i/3}function d(e,t,r){if(!t)return!(0,i.$3)(e);const s=e.length-1;switch((0,a.S)(e,s,r)){case 0:return!(0,i.$3)(e,1,2);case 1:return!(0,i.$3)(e,0,2);case 2:return!(0,i.$3)(e,0,1)}}}}]);
//# sourceMappingURL=53154.2cb4cb02.chunk.js.map