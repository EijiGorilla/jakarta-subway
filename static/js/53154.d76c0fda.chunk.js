"use strict";(self.webpackChunkjakarta_subway=self.webpackChunkjakarta_subway||[]).push([[1509,53154,58067],{10294(e,t,r){r.d(t,{S:()=>a});var s=r(15941),i=r(31633),o=r(20664),n=r(13927);function a(e,t,r){const a=function(e,t,r,s){const a=(e=>!Array.isArray(e[0]))(t)?(e,r)=>t[3*e+r]:(e,r)=>t[e][r],l=s?(0,i.GA)(s)/(0,i.G9)(s):1;return(0,n.lU)(e,(e,t)=>(0,o.j)(e,a(t,0)*l,a(t,1)*l,a(t,2)),r)}(l,e,t,r)?(0,n.Qj)(l):[0,0,1];return Math.abs(a[2])>Math.cos((0,s.kU)(80))?2:Math.abs(a[1])>Math.abs(a[0])?1:0}const l=(0,n.vt)()},40366(e,t,r){r.d(t,{F:()=>_,a:()=>g,b:()=>m});var s,i,o=r(57528),n=r(34761),a=r(13191),l=r(9392),c=r(86955),u=r(23687),h=r(12216),d=r(31432),p=r(2687);class _ extends d.Y{constructor(){super(...arguments),this.origin=l.uY}}function m(){const e=new p.N5;return e.attributes.add("position","vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new u.F("proj",e=>e.camera.projectionMatrix),new h.S("view",(e,t)=>(0,n.Tl)(f,t.camera.viewMatrix,e.origin))).main.add((0,c.H)(s||(s=(0,o.A)(["gl_Position = proj * view * vec4(position, 1.0);\ngl_Position.z = min(gl_Position.z, gl_Position.w);"])))),e.fragment.main.add((0,c.H)(i||(i=(0,o.A)(["fragColor = vec4(1., 0., 0., 0.);"])))),e}const f=(0,a.vt)(),g=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskDrawParameters:_,build:m},Symbol.toStringTag,{value:"Module"}))},50360(e,t,r){r.d(t,{Pg:()=>l,fz:()=>c,g7:()=>n,zo:()=>a});var s=r(68707),i=(r(97799),r(63331),r(56175));r(91523);const o=new i.D;function n(e,t,r){return o.execute(e,t,r,null)}function a(e,t,r){const i=o.executeMany(new s.S(e),t,r,null);return Array.from(i)}function l(e,t,r){return o.isSimpleAsFeature(e,t,r,null,null)}function c(){return o.supportsCurves()}},58067(e,t,r){r.r(t),r.d(t,{fromExtent:()=>v,fromGeometry:()=>g,fromMultipoint:()=>y,fromPoint:()=>w,fromPolygon:()=>R,fromPolyline:()=>A,fromSpatialReference:()=>b,getSpatialReference:()=>f,toExtent:()=>G,toGeometry:()=>C,toMultipoint:()=>x,toPoint:()=>M,toPolygon:()=>O,toPolyline:()=>P});var s=r(89379),i=r(26871),o=(r(21557),r(97799)),n=r(91523),a=r(63331),l=r(56175),c=r(76797),u=r(66388),h=r(19247),d=r(65215),p=r(23701),_=(r(59739),r(48045));const m="_gxVersion";function f(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function g(e){switch(e.type){case"point":return w(e);case"multipoint":return y(e);case"polyline":return A(e);case"polygon":return R(e);case"extent":return v(e);default:throw new Error("Unsupported geometry type: ".concat(e.type))}}function v(e){if(!e.getCacheValue(m)){const t=new n.E;t.setCoords(e.xmin,e.ymin,e.xmax,e.ymax),e.hasM&&t.setInterval(2,0,e.mmin,e.mmax),e.hasZ&&t.setInterval(1,0,e.zmin,e.zmax),e.setCacheValue(m,t)}return e.getCacheValue(m)}function y(e){if(!e.getCacheValue(m)){const s=new a.M,i=new n.P,o=e.points,l=e.hasM,c=e.hasZ,u=c?3:2;for(let e=0,n=o.length;e<n;e++){var t,r;const n=o[e];i.setXYCoords(n[0],n[1]),c&&i.setZ(null!==(t=n[2])&&void 0!==t?t:0),l&&i.setM(null!==(r=n[u])&&void 0!==r?r:NaN),s.add(i)}e.setCacheValue(m,s)}return e.getCacheValue(m)}function w(e){if(!e.getCacheValue(m)){const t=new n.P;t.setXYCoords(e.x,e.y),e.hasM&&t.setM(e.m),e.hasZ&&t.setZ(e.z),e.setCacheValue(m,t)}return e.getCacheValue(m)}function R(e){if(!e.getCacheValue(m)){const{curveRings:t,hasM:r,hasZ:s,rings:i}=e,o=(0,_.fromGeometryToGXGeometry)({curveRings:t,hasM:r,hasZ:s,rings:i});e.setCacheValue(m,o)}return e.getCacheValue(m)}function A(e){if(!e.getCacheValue(m)){const{curvePaths:t,hasM:r,hasZ:s,paths:i}=e,o=(0,_.fromGeometryToGXGeometry)({curvePaths:t,hasM:r,hasZ:s,paths:i});e.setCacheValue(m,o)}return e.getCacheValue(m)}function b(e){if(e.wkid)return(0,l.c)(e.wkid);const t=e.wkt2||e.wkt;return t?(0,l.b)(t):null}function C(e,t){if(e)switch(e.getGeometryType()){case o.G.enumPoint:return M(e,t);case o.G.enumEnvelope:return G(e,t);case o.G.enumMultiPoint:return x(e,t);case o.G.enumPolyline:return P(e,t);case o.G.enumPolygon:return O(e,t)}return null}function G(e,t){if(e.isEmpty())return null;const r=new c.A({xmin:e.getXMin(),ymin:e.getYMin(),xmax:e.getXMax(),ymax:e.getYMax(),spatialReference:t}),s=e.getDescription();if(s.hasM()){const t=e.queryInterval(2,0);r.mmin=t.vmin,r.mmax=t.vmax}if(s.hasZ()){const t=e.queryInterval(1,0);r.zmin=t.vmin,r.zmax=t.vmax}return r.setCacheValue(m,e),r}function x(e,t){if(e.isEmpty())return null;const r=e.getDescription(),s=r.hasM(),i=r.hasZ(),o=[],a=new n.P;for(let n=0,c=e.getPointCount();n<c;n++){e.getPointByVal(n,a);const t=[a.getX(),a.getY()];i&&t.push(a.getZ()),s&&t.push(a.getM()),o.push(t)}const l=new u.A({hasM:s,hasZ:i,points:o,spatialReference:t});return l.setCacheValue(m,e),l}function M(e,t){if(e instanceof i.P)return new h.A({x:e.x,y:e.y,spatialReference:t});if(e.isEmpty())return null;const r=new h.A({x:e.getX(),y:e.getY(),spatialReference:t}),s=e.getDescription();return s.hasM()&&(r.m=e.getM()),s.hasZ()&&(r.z=e.getZ()),r.setCacheValue(m,e),r}function O(e,t){if(e.isEmpty())return null;const r=d.A.fromJSON((0,s.A)({spatialReference:t},(0,_.toGeometry)(e,null)));return r.setCacheValue(m,e),r}function P(e,t){if(e.isEmpty())return null;const r=p.A.fromJSON((0,s.A)({spatialReference:t},(0,_.toGeometry)(e,null)));return r.setCacheValue(m,e),r}},68707(e,t,r){r.d(t,{G:()=>s,S:()=>i});class s{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}class i extends s{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}},73074(e,t,r){r.d(t,{P:()=>R});var s=r(54099),i=r(20664),o=r(9392),n=r(43047),a=r(55855),l=r(45308),c=r(42294),u=r(44815),h=r(18117),d=r(12482),p=r(731),_=r(85746),m=r(1307),f=r(49296),g=r(70667),v=r(29889),y=r(442),w=r(52479);class R extends _.X{constructor(e){var t;super(e),this._attachmentOrigin=(0,h.TH)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new s.bk,this._geometry=null,this._width=1,this._color=(0,a.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,a.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new m.o({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=null===(t=e.attached)||void 0===t||t}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:A,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:A,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,n.a)(e,this._color)||((0,n.d)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,n.a)(e,this._innerColor)||((0,n.d)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,n.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,a.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var e;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=null===(e=this.object3dResources.resources)||void 0===e?void 0:e.geometries;if(!t||0===t.length)return null;(0,i.j)(C,0,0,0);let r=0;for(const s of t)s.computeAttachmentOrigin(b)&&((0,i.g)(C,C,b),r++);return 0===r?null:((0,i.h)(C,C,1/r),this.view.renderCoordsHelper.fromRenderCoords(C,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(this._materialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const s of r)e.addGeometry(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new w.W(this._materialParameters,this.view.state.isGlobal),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r}}_createDrapedResources(){const e=new w.W(this._materialParameters,this.view.state.isGlobal);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,s=r.basemapTerrain.spatialReference;return null==t||null==s?[]:(0,v.A)(t,s).lines.map(t=>{let{position:i}=t;const o={overlayInfo:{spatialReference:s,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:i},removeDuplicateStartEnd:this._isClosed};return new y.$((0,g.te)(e,o))})}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const s=r.attributes.get("position"),i=(0,u.jh)(s.data.length);(0,l.projectBuffer)(s.data,t.spatialReference,0,i,this.view.spatialReference,0),(0,c.Hq)(e,i)}return!0}_createRenderGeometries(e,t){var r;const s=this.geometry;if(null==s)return;const i=(0,v.C)(s,this.view.elevationProvider,this.view.renderCoordsHelper,f.F.fromElevationInfo(null!==(r=this.elevationInfo)&&void 0!==r?r:new p.A({mode:(0,d.w7)(s,null)}))),o=new Array;for(const{position:n,mapPositions:a}of i.lines){const r={mapPositions:a,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push((0,g.te)(e,r)),o.push(n)}this._laserline.pathVerticalPlane=o}}function A(e){e.geometries=[]}const b=(0,o.vt)(),C=(0,o.vt)()},77176(e,t,r){r.d(t,{b:()=>o});var s=r(15941),i=r(38496);function o(e,t,r){var o;const u=Array.isArray(e),h=u?e.length/t:e.byteLength/(4*t),d=u?e:new Uint32Array(e,0,h*t),p=null!==(o=null===r||void 0===r?void 0:r.minReduction)&&void 0!==o?o:0,_=(null===r||void 0===r?void 0:r.originalIndices)||null,m=_?_.length:0,f=(null===r||void 0===r?void 0:r.componentOffsets)||null;let g=0;if(f)for(let s=0;s<f.length-1;s++){const e=f[s+1]-f[s];e>g&&(g=e)}else g=h;const v=Math.floor(1.1*g)+1;(null==c||c.length<2*v)&&(c=new Uint32Array((0,s.cU)(2*v)));for(let s=0;s<2*v;s++)c[s]=0;let y=0;const w=!!f&&!!_,R=w?m:h;let A=(0,i.my)(h);const b=new Uint32Array(m),C=1.96;let G=0!==p?Math.ceil(4*C*C/(p*p)*p*(1-p)):R,x=1,M=f?f[1]:R;for(let s=0;s<R;s++){if(s===G){const e=1-y/s;if(e+C*Math.sqrt(e*(1-e)/s)<p)return null;G*=2}if(s===M){for(let e=0;e<2*v;e++)c[e]=0;if(_)for(let e=f[x-1];e<f[x];e++)b[e]=A[_[e]];M=f[++x]}const e=w?_[s]:s,r=e*t,i=l(d,r,t);let o=i%v,a=y;for(;0!==c[2*o+1];){if(c[2*o]===i){const e=c[2*o+1]-1;if(n(d,r,e*t,t)){a=A[e];break}}o++,o>=v&&(o-=v)}a===y&&(c[2*o]=i,c[2*o+1]=e+1,y++),A[e]=a}if(0!==p&&1-y/h<p)return null;if(w){for(let e=f[x-1];e<b.length;e++)b[e]=A[_[e]];A=(0,i.uW)(b)}const O=u?new Array(y):new Uint32Array(y*t);y=0;for(let s=0;s<R;s++)A[s]===y&&(a(d,(w?_[s]:s)*t,O,y*t,t),y++);if(_&&!w){const e=new Uint32Array(m);for(let t=0;t<e.length;t++)e[t]=A[_[t]];A=(0,i.uW)(e)}return{buffer:Array.isArray(O)?O:O.buffer,indices:A,uniqueCount:y}}function n(e,t,r,s){for(let i=0;i<s;i++)if(e[t+i]!==e[r+i])return!1;return!0}function a(e,t,r,s,i){for(let o=0;o<i;o++)r[s+o]=e[t+o]}function l(e,t,r){let s=0;for(let i=0;i<r;i++)s=e[t+i]+s|0,s=s+(s<<11)+(s>>>2)|0;return s>>>0}let c=null},80069(e,t,r){r.d(t,{F:()=>p,a:()=>m,b:()=>_});var s,i=r(57528),o=r(75540),n=r(73398),a=r(21390),l=r(86955),c=r(72790),u=r(70367),h=r(31432),d=r(2687);class p extends h.Y{constructor(){super(...arguments),this.effect=0,this.fadeFactor=(0,o.v)(1)}}function _(){const e=new d.N5;return e.include(n.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new u.N("colorTexture",e=>e.color),new u.N("focusArea",e=>e.focusArea),new c.c("focusAreaEffectMode",e=>e.effect),new a.m("fadeFactor",e=>e.fadeFactor.value)).main.add((0,l.H)(s||(s=(0,i.A)(["\n      float mask = texture( focusArea, uv, 0.0 ).r;\n      vec4 color = texture( colorTexture, uv, 0.0 );\n      vec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\n      if (focusAreaEffectMode == ",") {\n        fragColor = mask > 0.0 ? color : mix(color, 0.55 * colorDeSaturate + 0.45, fadeFactor);\n      } else {\n        fragColor = mask > 0.0 ? color : mix(color, 0.33 * color, fadeFactor);\n      }\n  "])),l.H.int(0))),e}const m=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:p,build:_},Symbol.toStringTag,{value:"Module"}))},83457(e,t,r){r.d(t,{fz:()=>a,g7:()=>o,zo:()=>n});var s=r(68707);const i=new(r(20265).O);function o(e,t,r,s){return i.execute(e,t,r,s,null)}function n(e,t,r,o){const n=i.executeMany(new s.S(e),t,r,o,null);return Array.from(n)}function a(){return i.supportsCurves()}},85746(e,t,r){r.d(t,{X:()=>m});var s=r(6326),i=r(91967),o=r(5632),n=r(46053),a=(r(81806),r(76460),r(47249),r(87990));class l{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=2}destroy(){this._destroyResources()}get resources(){var e;return null===(e=this._resources)||void 0===e?void 0:e.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const r=null===(t=this._resources)||void 0===t?void 0:t.layerView;r&&(r.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new c({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=this._resourceFactory.view.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!0))}}let c=class extends((0,o.sA)(i.A)){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1,this.renderGroup=2}};(0,s.Cg)([(0,n.MZ)({constructOnly:!0})],c.prototype,"view",void 0),(0,s.Cg)([(0,n.MZ)({readOnly:!0})],c.prototype,"drapeSourceType",void 0),(0,s.Cg)([(0,n.MZ)()],c.prototype,"renderGroup",void 0),c=(0,s.Cg)([(0,a.$)("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],c);var u=r(69230),h=r(68134),d=r(37046),p=r(8918);class _{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,r=t.stage;if(!r)return;const s=new p.x(r,{pickable:!1,updatePolicy:1}),i=new d.B({castShadow:!1}),o=e.createResources(i,s);s.add(i);const n=e.cameraChanged,a=n?(0,h.wB)(()=>t.state.camera,e=>n(e),h.Vh):null;this._resources={layer:s,object:i,external:o,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class m extends u.B{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new _(this.createObject3DResourceFactory(e.view)),this.drapedResources=new l(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){var t,r;null!==(t=this.object3dResources)&&void 0!==t&&t.forEachMaterial(e),null===(r=this.drapedResources)||void 0===r||r.forEachMaterial(e)}}},94522(e,t,r){r.r(t),r.d(t,{FocusAreasView:()=>te});var s=r(6326),i=r(91967),o=r(18690),n=r(19276),a=r(50076),l=r(76460),c=r(43927),u=r(68134),h=r(31633),d=r(46053),p=(r(81806),r(87990)),_=r(38983),m=r(13191),f=r(9392),g=r(34111),v=r(19247),y=r(56611),w=r(83457),R=r(50360),A=r(58067),b=r(5809),C=r(44815),G=r(14556),x=r(38496),M=r(45136),O=r(49296),P=r(16266),E=r(36423),D=r(87925),S=r(89379),F=(r(47249),r(90364)),V=r(36451),j=r(80069),k=r(16506),T=r(59246),Z=r(11850),N=r(57162);class I extends T.w{constructor(e,t){super(e,t,new k.$(j.a,()=>r.e(81345).then(r.bind(r,81345))),Z.Nx)}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn})}}var q=r(93345);let H=class extends V.A{constructor(e){super((0,S.A)((0,S.A)({},e),{},{view:e.focusAreasView.view})),this.consumes={required:[F.OG.FOCUSAREA_COLOR,F.OG.FOCUSAREA]},this.produces=F.OG.FOCUSAREA_COLOR,this._fadeDirection=0,this._passParameters=new j.F}precompile(){this.techniques.precompile(I)}fadeOut(e){this.removeAllHandles(),this._startTime=null,this._fadeDirection=1,this.addHandles((0,u.wB)(()=>this._passParameters.fadeFactor.value,t=>{0===t&&(this.removeAllHandles(),e())})),this.requestRender(2)}render(e){var t,r,s;const i=this.techniques.get(I),o=e.find(e=>{let{name:t}=e;return t===this.produces});if(!i.compiled)return this.requestRender(1),o;const n=this.focusAreasView.style,a=this.bindParameters,l=a.camera,c=l.fullViewport[2],u=l.fullViewport[3];null!==(t=this._startTime)&&void 0!==t||(this._startTime=null===(r=this.view.stage)||void 0===r?void 0:r.renderer.renderContext.time);const h=this.view.qualitySettings.fadeDuration,d=h>0?Math.min(h,(null===(s=this.view.stage)||void 0===s?void 0:s.renderer.renderContext.time)-this._startTime)/h:1,p=e.find(e=>{let{name:t}=e;return t===F.OG.FOCUSAREA}),_=this.fboCache.acquire(c,u,this.produces),m=this.renderingContext;return m.bindFramebuffer(_.fbo),this._passParameters.color=o.getTexture(),this._passParameters.focusArea=p.getTexture(),this._passParameters.effect=z[n],this._passParameters.fadeFactor.value=0===this._fadeDirection?d:1-d,m.bindTechnique(i,a,this._passParameters),m.screen.draw(),_.attachDepth(o.getAttachment(q.nI)),d<1&&this.requestRender(2),_}};(0,s.Cg)([(0,d.MZ)()],H.prototype,"consumes",void 0),(0,s.Cg)([(0,d.MZ)()],H.prototype,"produces",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],H.prototype,"focusAreasView",void 0),H=(0,s.Cg)([(0,p.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],H);const z={bright:0,dark:1};var W=r(40366),U=r(75757);class B extends T.w{constructor(e,t){super(e,t,new k.$(W.a,()=>r.e(55698).then(r.bind(r,55698))),(0,U.Xk)(Z.SL))}initializePipeline(){return(0,N.Ey)({colorWrite:N.kn,depthTest:{func:515}})}}var $=r(69008),L=r(31432),X=r(9243);let Y=class extends V.A{constructor(e){super((0,S.A)((0,S.A)({},e),{},{view:e.focusAreasView.view})),this.consumes={required:[F.hM.TRANSPARENT]},this.produces=F.OG.FOCUSAREA,this._vaos=new Array,this._counts=new Array,this._origins=new Array,this._maskParameters=new W.F}initialize(){this.updateGeometries()}destroy(){this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0}precompile(){this.techniques.precompile(B)}render(e){const t=this.techniques.get(B),r=this.bindParameters,s=r.camera,i=s.fullViewport[2],o=s.fullViewport[3];if(!t.compiled||!this._vaos)return void this.requestRender(1);const n=e.find(e=>{let{name:t}=e;return t===F.hM.TRANSPARENT}),a=this.renderingContext,l=this.fboCache.acquire(i,o,F.OG.FOCUSAREA,2);this.view.stage.renderer.occludedRequiresStencil?(l.acquireDepth(13),a.blitFramebuffer(n.fbo,l.fbo,256)):l.attachDepth(n.getAttachment(q.nI)),a.bindFramebuffer(l.fbo),a.setClearColor(0,0,0,1),a.clear(17408),a.setViewport(0,0,i,o);const c=a.bindTechnique(t,r);a.setFaceCullingEnabled(!1),a.setStencilTestEnabled(!0),a.setStencilOpSeparate(1028,7680,34055,7680),a.setStencilOpSeparate(1029,7680,34056,7680),a.setDepthWriteEnabled(!1);for(let u=0;u<this._vaos.length;u++){const e=this._vaos[u],t=this._counts[u];this._maskParameters.origin=this._origins[u],c.bindDraw(r,L.m,this._maskParameters),a.bindVAO(e),a.setDepthTestEnabled(!0),a.setStencilWriteMask(255),a.setStencilFunction(519,0,255),a.setColorMask(!1,!1,!1,!1),a.drawArrays(q.WR.TRIANGLES,0,t),a.setDepthTestEnabled(!1),a.setStencilWriteMask(0),a.setStencilFunction(517,0,255),a.setColorMask(!0,!0,!0,!0),a.drawArrays(q.WR.TRIANGLES,0,t)}return l}updateGeometries(){this.view.stage&&(this._vaos.forEach(e=>e.dispose()),this._vaos.length=this._counts.length=this._origins.length=0,this.focusAreasView.volumes.forEach(e=>{const t=new Array;let r=0,s=0;e.geometryVolumes.forEach(e=>{const i=e.indicesBottom;r+=i.length;for(let r=0;r<i.length;r++)t.push(e.positions[3*(i[r]-1)]),t.push(e.positions[3*(i[r]-1)+1]),t.push(e.positions[3*(i[r]-1)+2]);const o=e.indicesExtruded;s+=o.length;for(let r=0;r<o.length;r++)t.push(e.positions[3*o[r]]),t.push(e.positions[3*o[r]+1]),t.push(e.positions[3*o[r]+2])});const i=new $.Z(this.renderingContext,new X.R(this.renderingContext,Z.SL,new Float32Array(t)));this._vaos.push(i),this._counts.push(r+s),this._origins.push(e.origin)}),this.requestRender(1))}};(0,s.Cg)([(0,d.MZ)()],Y.prototype,"consumes",void 0),(0,s.Cg)([(0,d.MZ)()],Y.prototype,"produces",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],Y.prototype,"focusAreasView",void 0),Y=(0,s.Cg)([(0,p.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaMaskNode")],Y);var J=r(69539),Q=r(30726),K=r(73074);let ee=class extends i.A{constructor(e){super(e)}initialize(){this.addHandles([(0,u.wB)(()=>this.area.enabled,()=>this._ensureElement(),u.Vh),(0,u.wB)(()=>{var e;return null===(e=this.area.outline)||void 0===e?void 0:e.color},e=>this._updateColor(e),u.Vh),(0,u.wB)(()=>this.area.geometries,e=>this._updateGeometries(e),u.Vh)])}destroy(){this.removeAllHandles(),this._outlineElement=(0,Q.pR)(this._outlineElement)}_ensureElement(){var e,t,r;this.area.enabled&&null!==(e=this.area.outline)&&void 0!==e&&e.color?null!==(t=this._outlineElement)&&void 0!==t||(this._outlineElement=new K.P({view:this.view,geometry:this._mergePolygons(this.area.geometries),isDraped:!0,attached:!0,isDecoration:!1,color:J.A.toUnitRGBA(null===(r=this.area.outline)||void 0===r?void 0:r.color),renderOccluded:4,width:3})):this._outlineElement=(0,Q.pR)(this._outlineElement)}_updateGeometries(e){this._ensureElement(),this._outlineElement&&(this._outlineElement.geometry=this._mergePolygons(e))}_updateColor(e){this._ensureElement(),this._outlineElement&&e&&(this._outlineElement.color=J.A.toUnitRGBA(e))}_mergePolygons(e){if(!e||0===e.length)return null;const t=e.at(0).clone();return t.rings.length=0,e.forEach(e=>t.rings.push(...e.rings)),t}};(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],ee.prototype,"view",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],ee.prototype,"area",void 0),ee=(0,s.Cg)([(0,p.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaOutlineItem")],ee);let te=class extends i.A{constructor(e){super(e),this._volumes=new Map,this._elevationContext=new O.F,this._outlineMap=new n.A}initialize(){this.addHandles([(0,u.wB)(()=>{var e;return{polygons:this.polygons,ready:null===(e=this.view.basemapTerrain)||void 0===e?void 0:e.ready}},e=>{let{polygons:t,ready:r}=e;r&&this._updateVolumes(t)},u.Vh)]),this._outlineMap=(0,c.L)(()=>{var e;return null===(e=this.areas)||void 0===e?void 0:e.areas},e=>new ee({area:e,view:this.view}),{recycleItems:!0})}destroy(){this.removeAllHandles(),this._outlineMap.destroy()}get areas(){var e;return null===(e=this.view.map)||void 0===e?void 0:e.focusAreas}get enabledAreas(){var e,t;return null!==(e=null===(t=this.areas)||void 0===t?void 0:t.areas.toArray().filter(e=>{let{enabled:t}=e;return t}))&&void 0!==e?e:[]}get style(){var e,t;return null!==(e=null===(t=this.areas)||void 0===t?void 0:t.style)&&void 0!==e?e:"bright"}get polygons(){return this.enabledAreas.reduce((e,t)=>e.concat(t.geometries.toArray()),new Array)}containsGeometry(e){if(0===this.polygons.length)return!0;const t=new v.A(e);return this.polygons.some(e=>e.contains(t))}_updateVolumes(e){this._extrude(e),this._ensureRenderNodes()}_extrude(e){var t;if(!this.view.renderCoordsHelper||(0,o.aI)(Array.from(this._volumes.keys()),e))return;const r=this.view.renderCoordsHelper,s=(0,f.vt)(),i=1===r.viewingMode,n=(0,m.vt)(),c=(0,m.vt)(),u=this.view.spatialReference,d=(0,A.fromSpatialReference)(u),p=(0,g.tO)(u).radius/G.$O.radius,v=(0,h.UW)(5e5*p,"meters",u,!0);i||r.worldUpAtPosition([0,0,0],s);const O=new Map;for(const o of e){const e=this._volumes.get(o);if(e)O.set(o,e);else try{var S;const e=u.equals(o.spatialReference)?o:(0,y.project)(o,u),t=Math.max(e.extent.width,e.extent.height),a=(0,h.PQ)(t,u,"meters",!0),l=Math.max(5*a,2e4*p),m=i?p/10:p,f=this._reduceGeometryHeight(e,l,m),g=(0,E.W$)(f);if(null==g)continue;const G=(0,A.fromPolygon)(f),F=null!==(S=(0,R.g7)(G,d,!1))&&void 0!==S?S:G,V=(0,w.g7)(F,v,0,0),j=(0,A.toPolygon)(V,u);if(null==j)continue;(0,b.l)(u,[g.x,g.y,0],n,r.spatialReference),c[12]=-n[12],c[13]=-n[13],c[14]=-n[14];const k=(0,D.C8)(j,this.view.elevationProvider,r,this._elevationContext),{polygons:T,mapPositions:Z,position:N}=k,I=new Array,q=new re(I,[n[12],n[13],n[14]]);for(const r of T){const e=r.count,t=(0,_.e)(r.mapPositions,r.holeIndices,3);if(0===t.length)continue;const o=t.length,n=6*e,a=n+o,u=(0,C.jh)(3*n),h=(0,x.my)(a),d=(0,x.my)(o);(0,P.K)(N,Z,t,r,u,null,null,null,h,d,l,s,i),(0,M.t)(u,u,c);const p=new se(u,d,h,l);I.push(p)}O.set(o,q)}catch(F){l.A.getLogger(this).error(new a.A("focusareasview:projection-failed","Failed to project focus area geometry to view spatial reference",{geometry:o,error:F}))}}this._volumes=O,0!==this.volumes.size&&(null===(t=this._maskRenderNode)||void 0===t||t.updateGeometries())}_ensureRenderNodes(){var e,t;if(this.view.stage)if(0===this.volumes.size){const{_maskRenderNode:e,_colorRenderNode:t}=this;this._maskRenderNode=this._colorRenderNode=null,null===t||void 0===t||t.fadeOut(()=>{null!==e&&void 0!==e&&e.destroy(),null===t||void 0===t||t.destroy()})}else null!==(e=this._maskRenderNode)&&void 0!==e||(this._maskRenderNode=new Y({focusAreasView:this})),null!==(t=this._colorRenderNode)&&void 0!==t||(this._colorRenderNode=new H({focusAreasView:this})),this.view.stage.renderView.requestRender()}_reduceGeometryHeight(e,t,r){const s=-12e5*r,i=Math.max(-t/2,s),o=e.rings.map(e=>e.map(e=>[e[0],e[1],i])),n=e.clone();return n.rings=o,n.hasZ=!0,n}get volumes(){return this._volumes}};(0,s.Cg)([(0,d.MZ)()],te.prototype,"_volumes",void 0),(0,s.Cg)([(0,d.MZ)({constructOnly:!0})],te.prototype,"view",void 0),te=(0,s.Cg)([(0,p.$)("esri.views.3d.FocusAreasView")],te);class re{constructor(e,t){this.geometryVolumes=e,this.origin=t}}class se{constructor(e,t,r,s){this.positions=e,this.indicesBottom=t,this.indicesExtruded=r,this.height=s}}},99785(e,t,r){r.d(t,{lO:()=>c,oR:()=>u});var s=r(38983),i=r(5262),o=r(44815),n=r(38496),a=r(10294),l=r(77176);function c(e){const t=u(e.rings,e.hasZ,1,e.spatialReference),r=new Array;let i=0,a=0;for(const l of t.polygons){const e=l.count,c=l.index,u=(0,o.l5)(t.position,3*c,3*e),h=l.holeIndices.map(e=>e-c),d=(0,n.uW)((0,s.e)(u,h,3));r.push({position:u,faces:d}),i+=u.length,a+=d.length}const c=function(e,t,r){if(1===e.length)return e[0];const s=(0,o.jh)(t),i=new Array(r);let a=0,l=0,c=0;for(const o of e){for(let e=0;e<o.position.length;e++)s[a++]=o.position[e];for(const e of o.faces)i[l++]=e+c;c=a/3}return{position:s,faces:(0,n.uW)(i)}}(r,i,a),h=Array.isArray(c.position)?(0,l.b)(c.position,3,{originalIndices:c.faces}):(0,l.b)(c.position.buffer,6,{originalIndices:c.faces});return c.position=(0,o.xm)(new Float64Array(h.buffer)),c.faces=h.indices,c}function u(e,t,r,s){const i=e.length,n=new Array(i),a=new Array(i),l=new Array(i);let c=0;for(let o=0;o<i;++o)c+=e[o].length;let u=0,p=0,_=0;const m=(0,o.jh)(3*c);let f=0;for(let o=i-1;o>=0;o--){const c=e[o],g=1===r&&d(c,t,s);if(g&&1!==i)n[u++]=c;else{let e=c.length;for(let t=0;t<u;++t)e+=n[t].length;const r={index:f,pathLengths:new Array(u+1),count:e,holeIndices:new Array(u)};r.pathLengths[0]=c.length,c.length>0&&(l[_++]={index:f,count:c.length}),f=g?h(c,c.length-1,-1,m,f,c.length,t):h(c,0,1,m,f,c.length,t);for(let s=0;s<u;++s){const e=n[s];r.holeIndices[s]=f,r.pathLengths[s+1]=e.length,e.length>0&&(l[_++]={index:f,count:e.length}),f=h(e,0,1,m,f,e.length,t)}u=0,r.count>0&&(a[p++]=r)}}for(let o=0;o<u;++o){const e=n[o];e.length>0&&(l[_++]={index:f,count:e.length}),f=h(e,0,1,m,f,e.length,t)}return a.length=p,l.length=_,{position:m,polygons:a,outlines:l}}function h(e,t,r,s,i,o,n){i*=3;for(let a=0;a<o;++a){const o=e[t];s[i++]=o[0],s[i++]=o[1],s[i++]=n&&o[2]?o[2]:0,t+=r}return i/3}function d(e,t,r){if(!t)return!(0,i.$3)(e);const s=e.length-1;switch((0,a.S)(e,s,r)){case 0:return!(0,i.$3)(e,1,2);case 1:return!(0,i.$3)(e,0,2);case 2:return!(0,i.$3)(e,0,1)}}}}]);
//# sourceMappingURL=53154.d76c0fda.chunk.js.map