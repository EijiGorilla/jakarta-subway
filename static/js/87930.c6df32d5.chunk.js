"use strict";(self.webpackChunkjakarta_subway=self.webpackChunkjakarta_subway||[]).push([[30416,87930],{1898(e,t,i){i.d(t,{i:()=>s});var n=i(1723);function s(e){var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:n.Tv}},18295(e,t,i){i.d(t,{B:()=>u});var n=i(89379),s=i(19276),r=i(54901),o=i(43927),a=i(3589),l=i(63078),d=i(83973);const h=s.A.ofType(a.A);function u(e,t){var i,s,u;const c=(0,o.L)(null!==t&&void 0!==t&&t.excludeInternal?()=>{var t;return null===(t=e.map)||void 0===t?void 0:t.allLayers.filter(e=>!("internal"in e)||!e.internal)}:()=>{var t;return null===(t=e.map)||void 0===t?void 0:t.allLayers},e=>new a.A({layer:e}),{recycleItems:!0,createCollection:()=>new h}),p=new d.A({enabled:!0,selfEnabled:null!==(i=null===t||void 0===t?void 0:t.selfEnabled)&&void 0!==i&&i,featureEnabled:!0,featureSources:c,distance:null!==(s=null===t||void 0===t?void 0:t.distance)&&void 0!==s?s:l.N.distance,touchSensitivityMultiplier:null!==(u=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==u?u:l.N.touchSensitivityMultiplier});return(0,n.A)((0,n.A)({},(0,r.DQ)(c)),{},{options:p})}},23290(e,t,i){i.d(t,{_:()=>u});var n=i(6326),s=i(91967),r=i(46053),o=(i(81806),i(76460),i(47249),i(87990)),a=i(65215),l=i(56611),d=i(2413),h=i(54222);let u=class extends s.A{constructor(e){super(e)}get bounds(){const e=this.coords;return null==(null===e||void 0===e?void 0:e.extent)?null:(0,d.VY)(e.extent)}get coords(){var e;const t=null===(e=this.element.georeference)||void 0===e?void 0:e.coords;return(0,l.projectOrLoad)(t,this.spatialReference).geometry}get normalizedCoords(){return a.A.fromJSON((0,h.jZ)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,d.VY)(e):null}};(0,n.Cg)([(0,r.MZ)()],u.prototype,"spatialReference",void 0),(0,n.Cg)([(0,r.MZ)()],u.prototype,"element",void 0),(0,n.Cg)([(0,r.MZ)()],u.prototype,"bounds",null),(0,n.Cg)([(0,r.MZ)()],u.prototype,"coords",null),(0,n.Cg)([(0,r.MZ)()],u.prototype,"normalizedCoords",null),(0,n.Cg)([(0,r.MZ)()],u.prototype,"normalizedBounds",null),u=(0,n.Cg)([(0,o.$)("esri.layers.support.MediaElementView")],u)},29201(e,t,i){i.d(t,{I:()=>x,a:()=>y,b:()=>f});var n,s,r=i(57528),o=i(26917),a=i(59395),l=i(90080),d=i(94192),h=i(80883),u=i(3799),c=i(21390),p=i(86955),v=i(70367),g=i(91911),m=i(31432),_=i(2687);class y extends m.Y{}function f(e){const t=new _.N5,{vertex:i,fragment:m,varyings:y}=t,{output:f,perspectiveInterpolation:x}=e;return(0,u.NB)(i,e),t.include(a.d),t.include(d.Z,e),t.fragment.include(o.HQ,e),t.include(l.g,e),t.include(g.z,e),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),x&&t.attributes.add("perspectiveDivide","float"),i.main.add((0,p.H)(n||(n=(0,r.A)(["\n    vpos = position;\n    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);\n    vTexCoord = uv0;\n    gl_Position = transformPosition(proj, view, vpos);\n    ",""])),(0,p.If)(x,"gl_Position *= perspectiveDivide;"))),y.add("vpos","vec3",{invariant:!0}),y.add("vTexCoord","vec2"),m.include(h.a),m.uniforms.add(new c.m("opacity",e=>e.opacity),new v.N("tex",e=>e.glTexture)).main.add((0,p.H)(s||(s=(0,r.A)(["\n    discardBySlice(vpos);\n    discardByTerrainDepth();\n    ","\n    vec4 finalColor = texture(tex, vTexCoord) * opacity;\n    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);"])),(0,p.If)(10===f,"fragColor = vec4(0, 0, 0, 1); return;"))),t}const x=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:y,build:f},Symbol.toStringTag,{value:"Module"}))},29304(e,t,i){i.d(t,{S:()=>r});var n=i(56497),s=i(86210);class r extends n.p{constructor(e,t,i){super(e,t),this._updateControlPoints=i,this.editSourcePoints=!1}updateVertices(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._apply(new o(this.data,e,t,this.editSourcePoints,this._updateControlPoints),i)}}class o extends s.D{constructor(e,t,i,n,s){super(e,t,i),this._editSourcePoints=n,this._updateControlPoints=s}_notifyChanges(e){super._notifyChanges(e),this._updateControlPoints(this._editSourcePoints)}canAccumulate(e){return this._editSourcePoints===e._editSourcePoints&&super.canAccumulate(e)}}},30416(e,t,i){i.d(t,{r:()=>E});var n=i(89379),s=i(88105),r=i(34981),o=i(59696),a=i(34812),l=i(45463),d=i(60322),h=i(86994),u=i(82809),c=i(63928),p=i(52757),v=i(16506),g=i(59246),m=i(96643),_=i(86401),y=i(29201),f=i(57162);class x extends g.w{constructor(e,t){super(e,t,new v.$(y.I,()=>i.e(48391).then(i.bind(i,48391))),w(t).locations)}_getPipelineState(e,t){const{oitPass:i,output:n,hasOccludees:s,cullFace:o}=e;return(0,f.Ey)({blending:(0,r.RN)(n)?(0,d.Yf)(i,!0):null,culling:(0,f.Xt)(o),depthTest:{func:(0,d.K_)(i)},depthWrite:(0,d.z5)(e),drawBuffers:(0,d.m6)(i,n),colorWrite:f.kn,stencilWrite:s?m.v0:null,stencilTest:s?t?m.a9:m.qh:null,polygonOffset:(0,d.mE)(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}function w(e){let t=_.l5;return e.perspectiveInterpolation&&(t=t.clone().f32("perspectiveDivide")),t}var C=i(6326),b=i(6485),T=i(92656);class M extends T.E{constructor(e){super(),this.draped=e,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}}(0,C.Cg)([(0,b.W)({count:3})],M.prototype,"cullFace",void 0),(0,C.Cg)([(0,b.W)()],M.prototype,"enableOffset",void 0),(0,C.Cg)([(0,b.W)()],M.prototype,"writeDepth",void 0),(0,C.Cg)([(0,b.W)()],M.prototype,"hasOccludees",void 0),(0,C.Cg)([(0,b.W)()],M.prototype,"terrainDepthTest",void 0),(0,C.Cg)([(0,b.W)()],M.prototype,"cullAboveTerrain",void 0),(0,C.Cg)([(0,b.W)()],M.prototype,"perspectiveInterpolation",void 0);class E extends c.W{constructor(e){super(e,S),this.supportsEdges=!0,this.produces=new Map([[2,e=>(0,r.CL)(e)],[4,e=>(0,r._o)(e)&&this.parameters.writeDepth],[8,e=>(0,r._o)(e)&&!this.parameters.writeDepth],[18,e=>(0,r._o)(e)||(0,r.CL)(e)]]),this._configuration=new M(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<d.xt,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new P(e)}createBufferWriter(){return new A(w(this.parameters))}}class P extends o.A{constructor(e){super((0,n.A)((0,n.A)({},e),e.material.parameters)),this.parameters=e;const t=this._material.parameters.texture;(0,a.y)(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(x,e)}}class A extends u.Z{write(e,t,i,n,r,o){for(const a of this.layout.fields.keys()){const n=i.get(a);if(n)if("perspectiveDivide"===a){(0,h.vA)(1===n.size);const e=r.getField(a,s.Y$);e&&(0,p.uO)(n,e,o)}else(0,p.Ap)(a,n,e,t,r,o)}return null}}class S extends l.q{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}},33723(e,t,i){i.d(t,{O:()=>c,W:()=>u});var n=i(86300),s=i(44680),r=i(19555),o=i(20664);const a=(0,i(9392).vt)(),l=(0,s.vt)(),d=(0,s.vt)(),h=(0,s.vt)();function u(e,t,i){return(0,o.j)(a,t[0],t[1],1),(0,o.o)(a,a,(0,n.mg)(l,i)),0===a[2]?(0,r.hZ)(e,a[0],a[1]):(0,r.hZ)(e,a[0]/a[2],a[1]/a[2])}function c(e,t,i){return p(d,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),p(h,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),(0,n.lw)(e,(0,n.KC)(d,d),h),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function p(e,t,i,s,r,d,h,u,c){(0,n.hZ)(e,t,s,d,i,r,h,1,1,1),(0,o.j)(a,u,c,1),(0,n.KC)(l,e);const[p,v,g]=(0,o.o)(a,a,(0,n.mg)(l,l));return(0,n.hZ)(l,p,0,0,0,v,0,0,0,g),(0,n.lw)(e,l,e)}},34699(e,t,i){i.d(t,{A:()=>d});var n=i(6326),s=i(46053),r=(i(81806),i(76460),i(47249),i(87990)),o=i(91967);let a=class extends o.A{constructor(e){super(e),this.editSourcePoints=!1}};(0,n.Cg)([(0,s.MZ)()],a.prototype,"editSourcePoints",void 0),a=(0,n.Cg)([(0,r.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions.ReshapeOptions")],a);let l=class extends o.A{constructor(e){super(e),this.tool="transform",this.reshapeOptions=new a}};(0,n.Cg)([(0,s.MZ)()],l.prototype,"tool",void 0),(0,n.Cg)([(0,s.MZ)({type:a})],l.prototype,"reshapeOptions",void 0),l=(0,n.Cg)([(0,r.$)("esri.views.3d.layers.support.MediaLayerInteractionOptions")],l);const d=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.layer=null,this.interactive=!1,this.interactionOptions=new l,this.selectedElement=null}highlight(e,t){throw new Error("missing implementation")}};return(0,n.Cg)([(0,s.MZ)()],i.prototype,"layer",void 0),(0,n.Cg)([(0,s.MZ)()],i.prototype,"interactive",void 0),(0,n.Cg)([(0,s.MZ)({type:l})],i.prototype,"interactionOptions",void 0),(0,n.Cg)([(0,s.MZ)()],i.prototype,"selectedElement",void 0),i=(0,n.Cg)([(0,r.$)("esri.views.layers.MediaLayerView")],i),i}},54222(e,t,i){i.d(t,{b3:()=>u,jZ:()=>h});var n=i(62825),s=i(2413),r=i(758),o=i(5262),a=i(19902),l=i(73548),d=i(80963);function h(e){return c(e,!0)}function u(e){return c(e,!1)}function c(e,t){if(null==e)return null;const i=e.spatialReference,s=(0,d.Vp)(i),o=(0,n.W)(e)?e.toJSON():e;if(!s)return o;const h=(0,d.K8)(i)?102100:4326,u=l.j7[h].maxX,c=l.j7[h].minX;if((0,a.fT)(o))return v(o,u,c);if((0,a.U9)(o))return o.points=o.points.map(e=>v(e,u,c)),o;if((0,a.ZC)(o))return p(o,s);if((0,a.Bi)(o)||(0,a.Rg)(o)){const e=(0,r.Rg)(x,o),i={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},n=(0,l.kd)(i.xmin,c)*(2*u),s=0===n?o:(0,l.kS)(o,n);return i.xmin+=n,i.xmax+=n,i.xmax>u?y(s,u,t):i.xmin<c?y(s,c,t):s}return o}function p(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:n,ymax:s,xmin:r,xmax:o}=e,a=e.xmax-e.xmin,[l,d]=t.valid,{x:h,frameId:u}=g(e.xmin,t),{x:c,frameId:p}=g(e.xmax,t),v=h===c&&a>0;if(a>2*d){const e={xmin:r<o?h:c,ymin:n,xmax:d,ymax:s},t={xmin:l,ymin:n,xmax:r<o?c:h,ymax:s},a={xmin:0,ymin:n,xmax:d,ymax:s},v={xmin:l,ymin:n,xmax:0,ymax:s},g=[],_=[];m(e,a)&&g.push(u),m(e,v)&&_.push(u),m(t,a)&&g.push(p),m(t,v)&&_.push(p);for(let i=u+1;i<p;i++)g.push(i),_.push(i);i.push(new f(e,[u]),new f(t,[p]),new f(a,g),new f(v,_))}else h>c||v?i.push(new f({xmin:h,ymin:n,xmax:d,ymax:s},[u]),new f({xmin:l,ymin:n,xmax:c,ymax:s},[p])):i.push(new f({xmin:h,ymin:n,xmax:c,ymax:s},[u]));return i}(e,t).map(e=>e.extent);return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}function v(e,t,i){if(Array.isArray(e)){const n=e[0];if(n>t){const i=(0,l.kd)(n,t);e[0]=n+i*(-2*t)}else if(n<i){const t=(0,l.kd)(n,i);e[0]=n+t*(-2*i)}}else{const n=e.x;if(n>t){const i=(0,l.kd)(n,t);e.x+=i*(-2*t)}else if(n<i){const t=(0,l.kd)(n,i);e.x+=t*(-2*i)}}return e}function g(e,t){const[i,n]=t.valid,s=2*n;let r,o=0;return e>n?(r=Math.ceil(Math.abs(e-n)/s),e-=r*s,o=r):e<i&&(r=Math.ceil(Math.abs(e-i)/s),e+=r*s,o=-r),{x:e,frameId:o}}function m(e,t){const{xmin:i,ymin:n,xmax:s,ymax:r}=t;return _(e,i,n)&&_(e,i,r)&&_(e,s,r)&&_(e,s,n)}function _(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function y(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=!(0,a.Rg)(e);if(n&&(0,o.m3)(e),i)return(new w).cut(e,t);const s=n?e.rings:e.paths,r=n?4:2,l=s.length,d=-2*t;for(let o=0;o<l;o++){const e=s[o];if(e&&e.length>=r){const t=[];for(const i of e)t.push([i[0]+d,i[1]]);s.push(t)}}return n?e.rings=s:e.paths=s,e}class f{constructor(e,t){this.extent=e,this.frameIds=t}}const x=(0,s.vt)();class w{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let i;if(this._xCut=t,e.rings)this._closed=!0,i=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,i=e.paths,this._minPts=2}for(const s of i){if(!s||s.length<this._minPts)continue;let e=!0;for(const t of s)e?(this.moveTo(t),e=!1):this.lineTo(t);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const s of this._linesIn)s&&s.length>=this._minPts&&i.push(s);const n=-2*this._xCut;for(const s of this._linesOut)if(s&&s.length>=this._minPts){for(const e of s)e[0]+=n;i.push(s)}return this._closed?e.rings=i:e.paths=i,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide===-1){const i=this._intersect(this._prevPt,e);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,i){this._closed?(this._lineIn.push([i<=0?e:this._xCut,t]),this._lineOut.push([i>=0?e:this._xCut,t])):(i<=0&&this._lineIn.push([e,t]),i>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,i){this._closed?(C(this._lineIn,i<=0?e:this._xCut,t),C(this._lineOut,i>=0?e:this._xCut,t)):i<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):i>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const i=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+i*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function C(e,t,i){const n=e.length;n>1&&e[n-1][0]===t&&e[n-2][0]===t?e[n-1][1]=i:e.push([t,i])}},63928(e,t,i){i.d(t,{W:()=>r});var n=i(45463),s=i(48168);class r extends n.i{intersect(e,t,i,n,r,o){return(0,s.Uy)(e,i,n,r,void 0,o)}intersectDraped(e,t,i,n){return(0,s.gz)(i[0],i[1],e,n)}}},75218(e,t,i){i.d(t,{X:()=>d});var n=i(89379),s=i(54901),r=i(77944),o=i(18295),a=i(64344);const l=new Map;function d(e){if(!l.has(e)){const t=(0,o.B)(e,{distance:10}),i=function(e,t){return new a.g({view:e,options:t})}(e,t.options);l.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=l.get(e);t.referenceCount++;const i=(0,s.hA)(()=>{return i=e,(n=t).referenceCount--,void(n.referenceCount>0||(0,r.d)(()=>{0===n.referenceCount&&(n.remove(),l.delete(i))}));var i,n});return(0,n.A)({snappingManager:t.snappingManager},i)}},83491(e,t,i){i.d(t,{w:()=>h});var n=i(6326),s=i(54901),r=i(50346),o=i(68134),a=i(46053),l=(i(81806),i(76460),i(47249),i(87990)),d=i(47700);const h=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,d.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,s.hA)(()=>e.abort())),await(0,o.C_)(()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady},t),(0,r.Te)(t);const i=(0,d.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,n.Cg)([(0,a.MZ)()],i.prototype,"view",void 0),(0,n.Cg)([(0,a.MZ)()],i.prototype,"slicePlaneEnabled",void 0),i=(0,n.Cg)([(0,l.$)("esri.views.3d.layers.LayerView3D")],i),i}},86401(e,t,i){i.d(t,{Ci:()=>s,KL:()=>a,dB:()=>o,l5:()=>r,wB:()=>l});var n=i(48549);const s=(0,n.BP)().vec3f("position").freeze(),r=(0,n.BP)().vec3f("position").vec2f16("uv0").freeze(),o=(0,n.BP)().vec3f("position").vec4u8("color").freeze(),a=(0,n.BP)().vec3f("position").vec2f("uv0").freeze(),l=(0,n.BP)().vec3f("position").vec2f("uv0").vec4u8("olidColor").freeze()},87930(e,t,i){i.r(t),i.d(t,{default:()=>q});var n=i(6326),s=i(50076),r=i(54901),o=(i(81806),i(85361)),a=i(33723),l=i(50346),d=i(68134),h=i(46053),u=(i(76460),i(47249),i(87990)),c=i(44680),p=i(2413),v=i(23290),g=i(83491),m=i(91967),_=i(15941),y=i(30726),f=i(31633),x=i(94967),w=i(99809),C=i(19555),b=i(72745),T=i(19451),M=i(29304),E=i(57308),P=i(82307),A=i(75218),S=i(28330),O=i(68655);const I=Symbol(),D=Symbol();let R=class extends m.A{get editSourcePoints(){var e;return!(null===(e=this.options)||void 0===e||!e.reshapeOptions.editSourcePoints)!==this._isEditSourcePointsToggled}get updating(){return this._updatingHandles.updating}get _preferredInteractionTool(){var e,t;return null!==(e=null===(t=this.options)||void 0===t?void 0:t.tool)&&void 0!==e?e:"transform"}get _toolType(){switch(this._preferredInteractionTool){case"transform":return"transform-3d";case"reshape":return"reshape-3d"}}get _validatedSelectedElement(){const e=this.selectedElement;if(!e)return null;const{layer:{source:t}}=this;return t?"hasElement"in t?t.hasElement(e)?e:null:t===e?e:null:null}constructor(e){super(e),this.enabled=!1,this._isEditSourcePointsToggled=!1,this._updatingHandles=new T.U,this._isOpacityToggled=!1,this._factor=1,this._tool=null,this._object=null,this._createToolAbortController=null,this._onPointerMove=(0,l.sg)(async e=>{const t=await this._updatingHandles.addPromise(this._findElementAtScreenPoint(e));this.destroyed||(this.removeHandles(D),t&&t!==this.selectedElement&&this.addHandles(this.view.acquireCursor("pointer","high"),D))}),this._tmpMat2=(0,w.vt)(),this._tmpVec2=(0,b.vt)()}destroy(){this._createToolAbortController=(0,y.DC)(this._createToolAbortController)}initialize(){this.addHandles([(0,r.DQ)(this._updatingHandles),this._updatingHandles.add(()=>this.enabled,e=>this._enableDisable(e),d.Vh),this._updatingHandles.add(()=>this._preferredInteractionTool,e=>this._preferredInteractionToolChanged(e))])}_enableDisable(e){if(!e)return void this.removeHandles(I);this._dynamicImports();const{view:t}=this,i=new P.oe;i.add(P.TU.undo,()=>{var e,t;null!==(e=this._object)&&void 0!==e&&null!==(e=e.operations)&&void 0!==e&&e.undo(),null===(t=this._object)||void 0===t||t.emit("modified-externally")}),i.add(P.TU.redo,()=>{var e,t;null!==(e=this._object)&&void 0!==e&&null!==(e=e.operations)&&void 0!==e&&e.redo(),null===(t=this._object)||void 0===t||t.emit("modified-externally")}),i.addToggle(P.TU.preserveAspectRatio,e=>{var t;"transform-3d"===(null===(t=this._tool)||void 0===t?void 0:t.type)&&(this._tool.preserveAspectRatio="key-down"===e.type)}),i.addToggle(P.TU.editSourcePoints,e=>{var t;"reshape-3d"===(null===(t=this._tool)||void 0===t?void 0:t.type)&&(this._isEditSourcePointsToggled="key-down"===e.type)}),i.addToggle(P.TU.rotateIncrements,e=>{var t;"transform-3d"===(null===(t=this._tool)||void 0===t?void 0:t.type)&&(this._tool.snapRotation="key-down"===e.type)}),i.add(P.TU.toggleOpacity,()=>{var e;const t=null===(e=this._object)||void 0===e?void 0:e.element;t&&(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)}),i.add(P.TU.moveUp,()=>this._move(0,this._factor)),i.add(P.TU.moveDown,()=>this._move(0,-this._factor)),i.add(P.TU.moveRight,()=>this._move(this._factor,0)),i.add(P.TU.moveLeft,()=>this._move(-this._factor,0)),i.addToggle(P.TU.factorModifier,e=>this._factor="key-down"===e.type?10:1),this._isOpacityToggled=!1,this.addHandles([i.register(t,E.oj.TOOL),(0,r.hA)(()=>{this._isOpacityToggled&&this.selectedElement&&(this.selectedElement.opacity*=2,this._isOpacityToggled=!1)}),t.on("immediate-click",e=>this._onClick(e),E.oj.TOOL),t.on("pointer-move",e=>this._onPointerMove(e).catch(()=>{}),E.oj.TOOL),this._updatingHandles.add(()=>this._validatedSelectedElement,(e,t)=>{t&&e!==t&&this._isOpacityToggled&&(t.opacity*=2,this._isOpacityToggled=!1),this._selectedElementChanged(e)},d.Vh),(0,r.hA)(()=>{this.removeHandles(D),this._removeTool()})],I)}async _onClick(e){await this._updatingHandles.addPromise(e.defer(async()=>{const t=await this._findElementAtScreenPoint(e);this.destroyed||(t&&e.stopPropagation(),this.selectedElement=t,this.selectedElement&&this.removeHandles(D))}))}async _selectedElementChanged(e){var t;null!==e&&void 0!==e&&e.georeference?(null===(t=this._object)||void 0===t?void 0:t.element)!==e&&await this._updatingHandles.addPromise(this._recreateTool()):this._removeTool()}async _recreateTool(){this._createToolAbortController=(0,y.DC)(this._createToolAbortController),this._removeTool();const e=this._validatedSelectedElement;if(!e)return;const t=new AbortController;this._createToolAbortController=t;const{ManipulatedObject3DMediaElement:i,ExtentTransformTool:n,ReshapeTool3D:s,automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:a}=await this._dynamicImports();if(t.signal.aborted)return;const{view:l,layer:h,_toolType:u}=this;switch(this._object=new i({view:l,layer:h,element:e,tool:this._preferredInteractionTool}),u){case"transform-3d":{this._tool=new n({view:l,object:this._object,automaticLengthMeasurementUtils:a});const e=l.inputManager;e.isModifierKeyDown(P.TU.rotateIncrements.key)&&(this._tool.snapRotation=!0),e.isModifierKeyDown(P.TU.preserveAspectRatio.key)&&(this._tool.preserveAspectRatio=!0)}break;case"reshape-3d":{const e=(0,A.X)(l),{snappingManager:t}=e;this._tool=new s({view:l,object:this._object,enableMidpoints:!1,enableZShape:!1,snappingManager:t,enableMoveObject:!1,autoHideManipulators:!0,enableDeleteVertices:!1,sketchOptions:{tooltips:{enabled:!0,inputEnabled:!0,visibleElements:{area:!1}}},automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:a}),this.addHandles([e,(0,d.wB)(()=>{var e;return{editSourcePoints:this.editSourcePoints,operations:null===(e=this._object)||void 0===e?void 0:e.operations}},e=>{e.operations instanceof M.S&&(e.operations.editSourcePoints=e.editSourcePoints)},d.pc)],this._tool)}}this.addHandles([(0,r.hA)(()=>{this._object=(0,y.pR)(this._object),this._tool&&(l.tools.remove(this._tool),this._tool=null)})],this._tool),l.addAndActivateTool(this._tool)}_preferredInteractionToolChanged(e){const{_tool:t}=this;if(!t)return;if(this._toolType!==t.type)return void this._updatingHandles.addPromise(this._recreateTool());const{_object:i}=this;i&&(i.tool=e)}async _dynamicImports(){const[{ManipulatedObject3DMediaElement:e},{ExtentTransformTool:t,ReshapeTool3D:n},s,r]=await Promise.all([Promise.all([i.e(9639),i.e(48479)]).then(i.bind(i,48479)),Promise.all([i.e(26871),i.e(16364),i.e(56175),i.e(48045),i.e(1307),i.e(86928),i.e(41010),i.e(94471),i.e(32488),i.e(88577),i.e(20205),i.e(22281),i.e(96999),i.e(68598)]).then(i.bind(i,68598)),(0,S.E)(),(0,O.f)()]);return{ManipulatedObject3DMediaElement:e,ExtentTransformTool:t,ReshapeTool3D:n,automaticAreaMeasurementUtils:s,automaticLengthMeasurementUtils:r}}async _findElementAtScreenPoint(e){const t=(await this.view.hitTest(e,{include:[this.layer]})).results[0];return"media"===(null===t||void 0===t?void 0:t.type)?t.element:null}_removeTool(){this._tool&&this.removeHandles(this._tool)}_move(e,t){const{view:i,_object:n}=this,s=null===n||void 0===n?void 0:n.operations;if(!s)return;const r=i.overlayPixelSizeInMapUnits(i.pointsOfInterest.focus.location)*(0,f.GA)(i.spatialReference)/(0,f.GA)(s.data.spatialReference),{_tmpMat2:o,_tmpVec2:a}=this,l=(0,x.$0)(o,(0,_.kU)(360-this.view.camera.heading)),d=(0,C.hZ)(a,r*e,r*t);(0,C.l0)(d,d,l),s.move(d[0],d[1],0),n.emit("modified-externally")}};(0,n.Cg)([(0,h.MZ)({constructOnly:!0})],R.prototype,"view",void 0),(0,n.Cg)([(0,h.MZ)({constructOnly:!0})],R.prototype,"layer",void 0),(0,n.Cg)([(0,h.MZ)()],R.prototype,"selectedElement",void 0),(0,n.Cg)([(0,h.MZ)()],R.prototype,"enabled",void 0),(0,n.Cg)([(0,h.MZ)()],R.prototype,"options",void 0),(0,n.Cg)([(0,h.MZ)()],R.prototype,"editSourcePoints",null),(0,n.Cg)([(0,h.MZ)()],R.prototype,"_isEditSourcePointsToggled",void 0),(0,n.Cg)([(0,h.MZ)()],R.prototype,"updating",null),(0,n.Cg)([(0,h.MZ)()],R.prototype,"_preferredInteractionTool",null),(0,n.Cg)([(0,h.MZ)()],R.prototype,"_validatedSelectedElement",null),R=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.support.MediaLayerInteraction")],R);var H=i(1599),Z=i(50468),L=i(17345),j=i(35416),z=i(442),U=i(96897),k=i(30416),B=i(91196),G=i(34699),W=i(1898),V=i(90992);let $=class extends((0,g.w)((0,G.A)(B.A))){get interactive(){return this._interaction.enabled}set interactive(e){this._interaction&&(this._interaction.enabled=e)}get selectedElement(){return this._interaction.selectedElement}set selectedElement(e){this._interaction&&(this._interaction.selectedElement=e)}get visibleAtCurrentScale(){return(0,V.E5)(this.layer.effectiveScaleRange,this.view.scale)}get usedMemory(){return Array.from(this._renderElements.values()).reduce((e,t)=>{var i,n;return e+(null!==(i=null===(n=t.getRenderData())||void 0===n?void 0:n.texture.usedMemory)&&void 0!==i?i:0)},0)}constructor(e){super(e),this.type="media-3d",this.drapeSourceType=1,this.updatePolicy=1,this.ignoresMemoryFactor=!0,this.unloadedMemory=0,this._uidToElement=new Map,this._highlightedElements=new Map,this._elementsInHighlightedId=new Map,this._renderElements=new Map,this._lastDrapingExtent=null,this._update=(0,l.sg)(async(e,t,i)=>{const n=await this._collectMediaElements(e,t,i);this._synchronizeRenderElements(n)},0);const{view:t,layer:i}=e;this._interaction=new R({view:t,layer:i}),this.addHandles((0,d.wB)(()=>this.interactionOptions,e=>this._interaction.options=e,d.pc))}initialize(){const{view:e,layer:t}=this;this._renderer=e.overlayManager.registerGeometryDrapeSource(this);const i=()=>this._updateWithLastDrapingExtent();this.addHandles([(0,r.hA)(()=>e.overlayManager.unregisterDrapeSource(this)),(0,d.on)(()=>t.effectiveSource,"change",i),(0,d.on)(()=>t.effectiveSource,"refresh",i)]),this._updatingHandles.add(()=>this.suspended,i)}destroy(){this._synchronizeRenderElements(new Set)}setDrapingExtent(e,t){this._lastDrapingExtent={overlays:e,spatialReference:t},this._updateWithLastDrapingExtent()}getHit(e){const t=this._uidToElement.get(e);return t?{type:"media",element:t,layer:this.layer}:null}highlight(e,t){const i=(0,W.i)(t),n=new j.h(i),s=(0,o.xZ)(e)?Array.from(e):[e];this._elementsInHighlightedId.set(n,s);for(const r of s){var a;const e=this._highlightedElements.get(r);e?e.add(n):this._highlightedElements.set(r,new Set([n]));const t=null===(a=this._renderElements.get(r))||void 0===a?void 0:a.getRenderData();t&&(t.renderGeometry.geometry.addHighlight(n),this._renderer.modifyGeometries([t.renderGeometry],8))}return(0,r.hA)(()=>{const e=this._elementsInHighlightedId.get(n);if(e){for(const i of e){var t;const e=this._highlightedElements.get(i);if(!e)continue;e.delete(n);const s=null===(t=this._renderElements.get(i))||void 0===t?void 0:t.getRenderData();s&&(s.renderGeometry.geometry.removeHighlight(n),this._renderer.modifyGeometries([s.renderGeometry],8)),0===e.size&&this._highlightedElements.delete(i)}this._elementsInHighlightedId.delete(n)}})}isUpdating(){return super.isUpdating()||this._interaction.updating}_updateWithLastDrapingExtent(){if(null==this._lastDrapingExtent||this.suspended)return void(this._renderer&&this._synchronizeRenderElements(new Set));const{overlays:e,spatialReference:t}=this._lastDrapingExtent;this._updatingHandles.addPromise(this._update(e,t).catch(()=>{}))}async _collectMediaElements(e,t,i){const n=this.layer.effectiveSource;return null==n?new Set:new Set((await Promise.all(e.map(e=>n.queryElements((0,p.w1)(e.extent,t),{signal:i})))).flat())}_synchronizeRenderElements(e){this._synchronizeRenderElementsRemove(e),this._synchronizeRenderElementsAdd(e)}_synchronizeRenderElementsRemove(e){this._renderElements.forEach((t,i)=>{e.has(i)||(this._removeElement(i,t),this.emit("element-render-changed",{element:i}))})}_synchronizeRenderElementsAdd(e){for(const t of e)this._renderElements.has(t)||this._createRenderElement(t)}_removeElement(e,t){this._destroyRenderData(e,t),this._renderElements.delete(e),this._uidToElement.delete(e.uid),t.handle.remove()}_createRenderElement(e){const t=new v._({spatialReference:this.view.spatialReference,element:e}),i=new N((0,r.vE)([this._updatingHandles.add(()=>e.opacity,e=>{var t;return null===(t=i.getRenderData())||void 0===t?void 0:t.material.setParameters({opacity:e})}),this._updatingHandles.add(()=>t.coords,()=>{i.data?this._updateGeometry(t,i):this._initializeRenderData(t,i)}),this._updatingHandles.add(()=>e.content,()=>this._initializeRenderData(t,i)),(0,r.DQ)(t)]));this._renderElements.set(e,i),this._uidToElement.set(e.uid,e),this._updatingHandles.addPromise(e.load().catch(()=>{})),this._initializeRenderData(t,i)}_initializeRenderData(e,t){const{coords:i,element:n}=e,{contentWidth:s,contentHeight:r}=n;if(null==i||null==n.content)return void this._destroyRenderData(n,t);if(t.data)return;const o=this._createTexture(n.content),a=o.load(this.view.stage.renderView.renderingContext),d=()=>{if(!o.loaded)return;this.view.stage.addTexture(o);const e=new k.r({draped:!0,texture:o,opacity:n.opacity,perspectiveInterpolation:!0}),a=this._getPositionAttributeArray(i),l=this._getPerspectiveDivideAttributeArray(a,s,r),d=[0,1,2,0,2,3],h=new L.V(e,[["position",new Z.n(a,d,3,!0)],["uv0",new Z.n([0,0,1,0,1,1,0,1],d,2,!0)],["perspectiveDivide",new Z.n(l,d,1,!0)]]),u=new z.$(h,{layerViewUid:this.uid,graphicUid:n.uid}),c=this._highlightedElements.get(n);null!==c&&void 0!==c&&c.forEach(e=>u.geometry.addHighlight(e)),this._renderer.addGeometries([u],0),t.data=new K(u,o,e),this.emit("element-render-changed",{element:n})};(0,l.$X)(a)?(t.data=o,this._updatingHandles.addPromise(a),a.then(d).catch(()=>o.dispose())):d()}_updateGeometry(e,t){const{coords:i,element:n}=e;if(null==i||null==n.content)return void this._destroyRenderData(n,t);const s=t.getRenderData();if(!s)return;const r=this._getPositionAttributeArray(i);s.renderGeometry.geometry.setAttributeData("position",r);const o=this._getPerspectiveDivideAttributeArray(r,n.contentWidth,n.contentHeight);s.renderGeometry.geometry.setAttributeData("perspectiveDivide",o),s.renderGeometry.geometry.invalidateBoundingInfo(),this._renderer.modifyGeometries([s.renderGeometry],2),this.emit("element-render-changed",{element:n})}_getPositionAttributeArray(e){const[t,i,n,s]=e.rings[0];return[t[0],t[1],H.bi,s[0],s[1],H.bi,n[0],n[1],H.bi,i[0],i[1],H.bi]}_getPerspectiveDivideAttributeArray(e,t,i){(0,a.O)(F,[0,0,t,0,t,i,0,i],[e[0],e[1],e[3],e[4],e[6],e[7],e[9],e[10]]);const n=F[6]/F[8]*t,s=F[7]/F[8]*i;return[1,1+n,1+n+s,1+s]}_destroyRenderData(e,t){const i=t.data;if(null==i)return;if(t.data=null,"dispose"in i)return void i.dispose();const n=i.texture;n.unload(),this.view.stage.removeTexture(n),this._renderer.removeGeometries([i.renderGeometry],2),this.emit("element-render-changed",{element:e})}_createTexture(e){const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,i=e instanceof HTMLImageElement?e.naturalHeight:e.height;if("getFrame"in e)throw new s.A("media-layer-view-3d","animation is not supported");return new U.g(e,{wrap:{s:33071,t:33071},preMultiplyAlpha:!0,width:t,height:i,mipmap:!0,updateCallback:()=>this.view.overlayManager.requestRender()})}get test(){}};(0,n.Cg)([(0,h.MZ)({readOnly:!0})],$.prototype,"type",void 0),(0,n.Cg)([(0,h.MZ)()],$.prototype,"layer",void 0),(0,n.Cg)([(0,h.MZ)()],$.prototype,"interactive",null),(0,n.Cg)([(0,h.MZ)()],$.prototype,"selectedElement",null),(0,n.Cg)([(0,h.MZ)({readOnly:!0})],$.prototype,"visibleAtCurrentScale",null),$=(0,n.Cg)([(0,u.$)("esri.views.3d.layers.MediaLayerView3D")],$);const F=(0,c.vt)();class N{constructor(e){this.handle=e}getRenderData(){return this.data&&"type"in this.data&&"RenderData"===this.data.type?this.data:null}}class K{constructor(e,t,i){this.renderGeometry=e,this.texture=t,this.material=i,this.type="RenderData"}}const q=$},91196(e,t,i){i.d(t,{A:()=>p});var n=i(6326),s=i(54099),r=i(5632),o=i(76460),a=i(30726),l=i(91291),d=i(46053),h=(i(81806),i(47249),i(87990)),u=i(19451),c=i(90992);let p=class extends((0,r.sA)((0,l.g)(s.nJ))){get spatialReferenceSupported(){return!0}constructor(e){super(e),this._updatingHandles=new u.U,this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",n=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";o.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(i,"')"),e)}})}destroy(){this._updatingHandles=(0,a.pR)(this._updatingHandles),this._set("parent",null)}get fullOpacity(){var e,t,i,n;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(n=this.parent)||void 0===n?void 0:n.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,i=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!i||!t.intersection(i).isEmpty}canResume(){var e,t;const i=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&this.parent&&!this.parent.suspended&&(null===(t=this.view)||void 0===t?void 0:t.ready)&&(0,c.g7)(i)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const n=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,c.g7)(n)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"spatialReferenceSupported",null),(0,n.Cg)([(0,d.MZ)()],p.prototype,"view",void 0),(0,n.Cg)([(0,d.MZ)()],p.prototype,"fullOpacity",null),(0,n.Cg)([(0,d.MZ)()],p.prototype,"layer",void 0),(0,n.Cg)([(0,d.MZ)()],p.prototype,"parent",void 0),(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"suspended",null),(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"suspendInfo",null),(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"legendEnabled",null),(0,n.Cg)([(0,d.MZ)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"updatingProgress",null),(0,n.Cg)([(0,d.MZ)()],p.prototype,"updateSuspended",null),(0,n.Cg)([(0,d.MZ)()],p.prototype,"visible",null),(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentScale",null),(0,n.Cg)([(0,d.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentTimeExtent",null),p=(0,n.Cg)([(0,h.$)("esri.views.layers.LayerView")],p)}}]);
//# sourceMappingURL=87930.c6df32d5.chunk.js.map