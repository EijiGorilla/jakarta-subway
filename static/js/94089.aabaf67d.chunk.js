"use strict";(self.webpackChunkjakarta_subway=self.webpackChunkjakarta_subway||[]).push([[94089],{14318(e,t,i){i.d(t,{O:()=>u});var s=i(89379),n=i(6326),r=i(91967),a=i(30726),o=i(50346),l=i(46053),h=(i(81806),i(76460),i(47249),i(87990)),d=i(59752);let u=class extends r.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)(async(e,t,i,n)=>{const r=this._frameTask;if(null==r)return;const a=await r.schedule(()=>t.snap((0,s.A)((0,s.A)({},e),{},{context:i,signal:n})),n);a.valid&&await r.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update((0,s.A)((0,s.A)({},this._snapPoints),{},{context:i})))},n)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(d.W6.SNAPPING):d.nu}destroy(){this._abortController=(0,a.DC)(this._abortController),this._frameTask=(0,a.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:s,scenePoint:n}=e,r=t.update({point:s,scenePoint:n,context:i});return this.stagedPoint=r,r}async snap(e,t,i){const{point:s,scenePoint:n}=e;return this.stagedPoint=t.update({point:s,scenePoint:n,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,a.DC)(this._abortController),this._snapPoints=null}};(0,n.Cg)([(0,l.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,n.Cg)([(0,l.MZ)()],u.prototype,"stagedPoint",null),(0,n.Cg)([(0,l.MZ)()],u.prototype,"constrainResult",void 0),(0,n.Cg)([(0,l.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,n.Cg)([(0,h.$)("esri.views.interactive.snapping.SnappingOperation")],u)},46576(e,t,i){i.d(t,{T:()=>n});var s=i(96342);function n(e){const t=new s.n(e);return t.options.store=0,t.options.excludeLabels=!0,t}},86401(e,t,i){i.d(t,{Ci:()=>n,KL:()=>o,dB:()=>a,l5:()=>r,wB:()=>l});var s=i(48549);const n=(0,s.BP)().vec3f("position").freeze(),r=(0,s.BP)().vec3f("position").vec2f16("uv0").freeze(),a=(0,s.BP)().vec3f("position").vec4u8("color").freeze(),o=(0,s.BP)().vec3f("position").vec2f("uv0").freeze(),l=(0,s.BP)().vec3f("position").vec2f("uv0").vec4u8("olidColor").freeze()},87230(e,t,i){i.d(t,{C:()=>_,b:()=>m});var s,n,r=i(57528),a=i(26917),o=i(94192),l=i(80883),h=i(3799),d=i(95756),u=i(58350),p=i(86955),c=i(91911),g=i(2687);function m(e){const t=new g.N5,{vertex:i,fragment:m,varyings:_}=t;return t.fragment.include(a.HQ,e),t.include(o.Z,e),t.include(c.z,e),(0,h.NB)(i,e),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),_.add("vUV","vec2"),_.add("vpos","vec3"),i.main.add((0,p.H)(s||(s=(0,r.A)(["vUV = uv0;\nvpos = position;\nforwardViewPosDepth((view * vec4(position, 1.0)).xyz);\ngl_Position = proj * view * vec4(position, 1.0);"])))),m.uniforms.add(new d.G("size",e=>e.size)),m.uniforms.add(new u.E("color1",e=>e.color1)),m.uniforms.add(new u.E("color2",e=>e.color2)),m.include(l.a),m.main.add((0,p.H)(n||(n=(0,r.A)(["discardByTerrainDepth();\nvec2 uvScaled = vUV / (2.0 * size);\nvec2 uv = fract(uvScaled - 0.25);\nvec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\nfloat fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\nfloat t = mix(abs(ab.x + ab.y), 0.5, fade);\nfragColor = mix(color2, color1, t);\noutputColorHighlightOID(fragColor, vpos, fragColor.rgb);"])))),t}const _=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},94089(e,t,i){i.r(t),i.d(t,{default:()=>Pt});var s=i(6326),n=(i(81806),i(30726)),r=i(46053),a=i(76460),o=(i(47249),i(87990)),l=i(19747),h=i(2522),d=i(91967),u=i(68134),p=i(15941),c=i(24648),g=i(31633),m=i(19555),_=i(72745),v=i(20664),y=i(9392),w=i(55855),f=i(34111),M=i(56611),C=i(98510),P=i(14487);function V(e,t,i,s,n){(0,v.d)(S,e),(0,v.g)(L,e,t),(0,P.F)(S,i,S,n),(0,P.F)(L,i,L,n),(0,v.e)(s,L,S),(0,v.n)(s,s)}const S=(0,y.vt)(),L=(0,y.vt)();var b=i(64232),D=i(38496),x=i(65658),A=i(78315),R=i(45097),O=i(77515),Z=i(80935),z=i(94966),G=i(78009),k=i(29772),I=i(90659),H=i(41868);class T{get numVertices(){return this._length}get hasStagedVertex(){return null!=this._lastCursorPoint}constructor(e,t,i){var s,n;this._sceneView=e,this._geodesicAreaMeasurementUtils=t,this._geodesicLengthMeasurementUtils=i,this.validMeasurement=!1,this.positionsWorld=[],this.positionsRender=[],this.positionsFittedWorld=[],this.positionsFittedRender=[],this.positionsGeodesic=[],this.positionsSpherical=[],this.positionsStereographic=[],this.pathSegmentLengths=[],this.geodesicPathSegmentLengths=[],this.perimeterSegmentLengths=[],this.intersectingSegments=new Set,this.geodesicIntersectingSegments=new Set,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.areaCentroidWorldCoords=(0,y.vt)(),this.areaCentroidRenderCoords=(0,y.vt)(),this.geodesicAreaCentroidRenderCoords=(0,y.vt)(),this.fittingMode=null,this.area=null,this.geodesicArea=null,this.pathLength=null,this.geodesicPathLength=null,this.perimeterLength=null,this._length=0,this._centroidRenderCoords=(0,y.vt)(),this._planeWorldCoords=(0,w.vt)(),this._worldUp=(0,y.vt)(),this._worldTangent=(0,y.vt)(),this._frame=[(0,y.vt)(),(0,y.vt)(),(0,y.vt)()],this._lastPathVersion=-1,this._lastCursorPoint=null,this._mode=null,this._tempU=(0,y.vt)(),this._tempV=(0,y.vt)(),this._tempVec3=(0,y.vt)(),this._tempSphere=(0,A.c)();const r=(0,H.l)(e.spatialReference);this._measurementSR=r,this._lengthMeasurementUnit=null!==(s=(0,g._H)(r))&&void 0!==s?s:"meters",this._areaMeasurementUnit=null!==(n=(0,g.B5)(r))&&void 0!==n?n:"square-meters"}update(e,t,i,s,n,r){const a=this._lastPathVersion===e.version,o=t?t.equals(this._lastCursorPoint):null==this._lastCursorPoint,l=this._mode===n;return!(a&&!r&&l&&o)&&(this._lastPathVersion=e.version,this._lastCursorPoint=t,this._updateCursorSegmentLength(e,t),this._update(e,t,i,s,n),!0)}_update(e,t,i,s,n){const r=this._sceneView.renderSpatialReference,a=this._measurementSR,o=i.spatialReference;let l=e.numVertices;const h=!(null==t||t.equals(e.lastPoint)||l>2&&t.equals(e.firstPoint)||e.polygonIsClosed);h&&(l+=1);const d=!e.polygonIsClosed&&l>2,u=e.polygonIsClosed||d;this._resize(l);const p=(0,C.lO)(o),g=null!=o&&(0,I.yF)(o)?o:null,m=null!=g&&(0,M.canProjectWithoutEngine)(o,p),{positionsGeodesic:_,positionsWorld:y,positionsRender:w,positionsSpherical:f}=this,P=(e,t)=>{(function(e,t){var i;t.hasZ||(t.z=null!==(i=(0,Z.R1)(e,t,"ground"))&&void 0!==i?i:0)})(i.elevationProvider,e),(0,b.g)(e,y[t],a),(0,b.g)(e,w[t],r),m&&((0,b.g)(e,_[t],g),(0,b.g)(e,f[t],p),(0,v.n)(f[t],f[t]))};e.forEachVertexPosition((e,t)=>P(e,t)),h&&P(t,l-1);const V=this._updatePathLengths(u);if(this.pathLength=this._length>1?(0,c.d_)(V,this._lengthMeasurementUnit):null,m){const e=this._updateGeodesicPathLengths(u,g);this.geodesicPathLength=null!=e&&this._length>1?e:null}else this.geodesicPathLength=null;if(this._updateMode(n),!u)return this.area=null,this.geodesicArea=null,this.perimeterLength=null,this.triangleIndices=null,this.geodesicTriangleIndices=null,this.intersectingSegments.clear(),this.geodesicIntersectingSegments.clear(),void(this.validMeasurement=!1);this._updateAreaAndPerimeterLength(i,r,a,s),m&&this._updateGeodesicArea(i,g),this.validMeasurement=!0}getData(){return{validMeasurement:this.validMeasurement,numVertices:this.numVertices,hasStagedVertex:this.hasStagedVertex,positionsRender:this.positionsRender,positionsFittedWorld:this.positionsFittedWorld,positionsFittedRender:this.positionsFittedRender,intersectingSegments:this.intersectingSegments,geodesicIntersectingSegments:this.geodesicIntersectingSegments,triangleIndices:this.triangleIndices,geodesicTriangleIndices:this.geodesicTriangleIndices,areaCentroidRenderCoords:this.areaCentroidRenderCoords,geodesicAreaCentroidRenderCoords:this.geodesicAreaCentroidRenderCoords,area:this.area,geodesicArea:this.geodesicArea,pathLength:this.pathLength,geodesicPathLength:this.geodesicPathLength,perimeterLength:this.perimeterLength,actualMeasurementMode:this.actualMeasurementMode}}_resize(e){for(e<this._length&&(this.positionsWorld.length=e,this.positionsRender.length=e,this.positionsFittedWorld.length=e,this.positionsFittedRender.length=e,this.positionsGeodesic.length=e,this.positionsSpherical.length=e,this.positionsStereographic.length=e,this.pathSegmentLengths.length=e,this.geodesicPathSegmentLengths.length=e,this.perimeterSegmentLengths.length=e,this._length=e);this._length<e;)this.positionsWorld.push((0,y.vt)()),this.positionsRender.push((0,y.vt)()),this.positionsFittedWorld.push((0,_.vt)()),this.positionsFittedRender.push((0,y.vt)()),this.positionsGeodesic.push((0,y.vt)()),this.positionsSpherical.push((0,y.vt)()),this.positionsStereographic.push((0,_.vt)()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),this.perimeterSegmentLengths.push(0),++this._length}_updatePathLengths(e){const t=this.positionsWorld,i=this.pathSegmentLengths;let s=0;const n=this._length;for(let r=0;r<n;++r){const a=i[r]=(0,v.k)(t[r],t[(r+1)%n]);(r<n-1||e)&&(s+=a)}return s}_updateGeodesicPathLengths(e,t){const i=this.positionsGeodesic,s=this.geodesicPathSegmentLengths;let n=0;const r=this._length;for(let a=0;a<r;++a){const o=this._geodesicLengthMeasurementUtils.geodesicDistance(i[a],i[(a+1)%r],t);if(null==o)return null;const l=(0,c.kM)(o,"meters").value,h=s[a]=l;(a<r-1||e)&&(n+=h)}return(0,c.d_)(n,"meters")}_updateAreaAndPerimeterLength(e,t,i,s){const n=e.renderCoordsHelper,r=this.positionsWorld,a=this.positionsRender,o=this.positionsFittedWorld,l=this.positionsFittedRender,h=this._planeWorldCoords,d=this._centroidRenderCoords;(0,z.ix)(a,d),n.worldUpAtPosition(d,this._worldUp),n.worldBasisAtPosition(d,0,this._worldTangent),V(d,this._worldUp,t,this._worldUp,i),V(d,this._worldTangent,t,this._worldTangent,i),r.length>2&&(0,O.OK)(r,h),this.fittingMode=this._selectFittingMode(h,r,this._worldUp,s);let u=0;if("horizontal"===this.fittingMode){let e=-1/0;a.forEach((t,i)=>{const s=n.getAltitude(a[i]);s>e&&(e=s,u=i)})}const p=r[u];let c=h,g=this._worldTangent;"horizontal"===this.fittingMode?c=this._worldUp:"vertical"===this.fittingMode&&(c=this._tempVec3,g=this._worldUp,(0,z.YH)(h,this._worldUp,c)),(0,v.d)(this._frame[2],c),(0,z.YH)(g,c,this._frame[0]),(0,v.i)(this._frame[1],this._frame[0],this._frame[2]),(0,v.u)(this._frame[1],this._frame[1]);const _=this._tempVec3,y=this._tempU,w=this._tempV;for(let f=0;f<this._length;++f){const e=o[f],s=l[f];(0,v.e)(_,r[f],p),(0,m.hZ)(e,(0,v.f)(this._frame[0],_),(0,v.f)(this._frame[1],_)),(0,v.h)(y,this._frame[0],e[0]),(0,v.h)(w,this._frame[1],e[1]),(0,v.g)(_,y,w),(0,v.g)(_,_,p),(0,P.F)(_,i,s,t)}this.perimeterLength=this._length>0?this._updatePerimeterLengths():null,(0,z.ix)(l,this.areaCentroidRenderCoords),(0,P.F)(this.areaCentroidRenderCoords,t,this.areaCentroidWorldCoords,i),this._updateIntersectingSegments(),this.area=0===this.intersectingSegments.size?this._computeArea():null}_updateGeodesicArea(e,t){const{renderCoordsHelper:i,spatialReference:s}=e,{positionsSpherical:n,positionsStereographic:r}=this,a=this._tempVec3,o=(0,O.Gc)(n,a);if(!o)return void(this.geodesicArea=null);const l=this._tempU,h=this._tempV;(0,z.VV)(a,l,h);for(let d=0;d<this._length;++d){const e=(0,v.f)(n[d],l),t=(0,v.f)(n[d],h),i=(0,v.f)(n[d],a);(0,m.hZ)(r[d],e/i,t/i)}(0,v.h)(a,a,(0,f.tO)(s).radius),i.toRenderCoords(a,(0,C.lO)(s),this.geodesicAreaCentroidRenderCoords),this._updateGeodesicIntersectingSegments(),this.geodesicArea=o&&0===this.geodesicIntersectingSegments.size?this._computeGeodesicArea(t):null}_updatePerimeterLengths(){const e=this.positionsFittedWorld,t=this.perimeterSegmentLengths;let i=0;for(let s=0;s<this._length;++s)i+=t[s]=(0,m.Io)(e[s],e[(s+1)%this._length]);return(0,c.d_)(i,this._lengthMeasurementUnit)}_updateIntersectingSegments(){const e=this.positionsFittedWorld,t=this.intersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const n=e[i],r=e[(i+1)%this._length],a=e[s],o=e[(s+1)%this._length];(0,x.Ql)(n,r,a,o)&&(t.add(i),t.add(s))}}_computeArea(){const e=this.positionsFittedWorld,t=this.triangleIndices=(0,D.Dg)((0,G.lO)(e));let i=0;for(let s=0;s<t.length;s+=3)i+=(0,R.Fm)(e[t[s]],e[t[s+1]],e[t[s+2]]);return(0,c.gT)(i,this._areaMeasurementUnit)}_updateGeodesicIntersectingSegments(){const e=this.positionsStereographic,t=this.geodesicIntersectingSegments;t.clear();for(let i=0;i<this._length;++i)for(let s=i+2;s<this._length;++s){if((s+1)%this._length===i)continue;const n=e[i],r=e[(i+1)%this._length],a=e[s],o=e[(s+1)%this._length];(0,x.Ql)(n,r,a,o)&&(t.add(i),t.add(s))}}_computeGeodesicArea(e){const t=this.positionsGeodesic,i=this.positionsStereographic,s=this.geodesicTriangleIndices=(0,D.Dg)((0,G.lO)(i));let n=0;for(let r=0;r<s.length;r+=3){const i=(0,O.zS)(t[s[r]],t[s[r+1]],t[s[r+2]],e,this._geodesicAreaMeasurementUtils);if(null==i)return null;n+=(0,c.kM)(i,"square-meters").value}return(0,c.gT)(n,"square-meters")}_selectFittingMode(e,t,i,s){const n=t.map(t=>Math.abs((0,O.CL)(e,t))).reduce((e,t)=>Math.max(e,t),0);(0,O.uc)(t,this._tempSphere);const r=n/(2*this._tempSphere[3]),a=r<s.maxRelativeErrorCoplanar,o=r<s.maxRelativeErrorAlmostCoplanar;let l="horizontal";return a?l="oblique":o&&(l=Math.abs((0,v.f)(i,e))>Math.cos((0,p.kU)(s.verticalAngleThreshold))?"horizontal":"vertical"),l}_updateCursorSegmentLength(e,t){var i;const s=e.lastPoint;e.isValidPolygon||null==s||null==t?(this.geodesicStagedSegmentLength=null,this.stagedSegmentLength=null):(this.geodesicStagedSegmentLength=this._geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(s,t),this.stagedSegmentLength=null===(i=(0,k.NH)(s,t))||void 0===i?void 0:i.direct)}_updateMode(e){if(0===e){this.actualMeasurementMode="euclidean";let e=0;null!=this.geodesicPathLength&&(e+=this.geodesicPathLength.value),e>E&&(this.actualMeasurementMode="geodesic")}else this.actualMeasurementMode=1===e?"euclidean":"geodesic";null==this.geodesicPathLength&&(this.actualMeasurementMode="euclidean"),this._mode=e}}const E=1e5;let F=class extends d.A{constructor(e){super(e)}initialize(){this._measurementDataManager=new T(this.view,this.geodesicAreaMeasurementUtils,this.geodesicLengthMeasurementUtils),this.addHandles([this.analysisViewData.path.on("change",()=>this._update()),(0,u.wB)(()=>this.analysisViewData.stagedPoint,()=>this._update(),u.OH),(0,u.wB)(()=>this.analysisViewData.mode,()=>this._update(),u.OH)]),this._update()}_update(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{analysisViewData:t,view:i}=this;this._measurementDataManager.update(t.path,t.stagedPoint,i,{maxRelativeErrorCoplanar:.005,maxRelativeErrorAlmostCoplanar:.01,verticalAngleThreshold:80},t.mode,e)&&(t.measurementData=this._measurementDataManager.getData())}};(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],F.prototype,"view",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],F.prototype,"analysis",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],F.prototype,"analysisViewData",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],F.prototype,"geodesicAreaMeasurementUtils",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],F.prototype,"geodesicLengthMeasurementUtils",void 0),F=(0,s.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementController")],F);var W=i(54099),B=i(19247),U=i(2413),q=i(17430),j=i(89238),N=i(974),Q=i(56497);let J=class extends W.nJ{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._version=0,this._internalGeometryChange=!1,this._extent=(0,U.Ie)()}set areaMeasurement(e){this._set("areaMeasurement",e),null!=e&&null!=this.view&&this._initialize(e,this.view)}set view(e){this._set("view",e),null!=e&&null!=this.areaMeasurement&&this._initialize(this.areaMeasurement,e)}get constructed(){return null!=this.areaMeasurement&&null!=this.view}get version(){return this._version}get isEmptyPolygon(){return!this.constructed||0===this._editGeometry.parts.length}get isValidPolygon(){return this.constructed&&this.polygonIsClosed}get extent(){var e;if(this.constructed&&null!==(e=this._editGeometry.parts[0])&&void 0!==e&&e.vertices.length){const e=(0,U.Ie)(this._extent);return this.forEachVertex(t=>{(0,U.tK)(e,t.pos)}),e}return null}get spatialReference(){return this.constructed?this._editGeometry.coordinateHelper.spatialReference:null}_initialize(e,t){this.removeAllHandles(),this.addHandles((0,u.wB)(()=>e.geometry,()=>{this._updateEditGeometryFromModelGeometry(e,t)},u.pc)),this._makeDirty(!0)}_makeDirty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.notifyChange("polygonIsClosed"),this.notifyChange("isValidPolygon"),this.notifyChange("initialized"),this.notifyChange("extent"),e&&this.notifyChange("numVertices")}_updateEditGeometryFromModelGeometry(e,t){if(this._version++,this._internalGeometryChange)return;this.removeHandles("EditGeometry");let i=e.geometry;if(null!=i){const s=(0,M.tryProjectWithZConversion)(i,t.spatialReference);null==s&&(0,q.V)(e,i.spatialReference,a.A.getLogger(this)),i=s}this._editGeometryOperations=null!=i?Q.p.fromGeometry(i,t.state.viewingMode):new Q.p(new N.ZE("polygon",(0,j.BV)(!0,!1,t.spatialReference)),t.state.viewingMode),this._makeDirty(!0),this.emit("change"),this.addHandles(this._editGeometry.on("change",t=>{this._makeDirty(null!=t.addedVertices||null!=t.removedVertices),this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.geometry:null,this._internalGeometryChange=!1}),"EditGeometry")}get _editGeometry(){return this._editGeometryOperations.data}get vertices(){const e=[];return this.forEachVertex(t=>{e.push(t)}),e}get numVertices(){var e,t;return this.constructed&&null!==(e=null===(t=this._editGeometry.parts[0])||void 0===t?void 0:t.vertices.length)&&void 0!==e?e:0}get polygonIsClosed(){var e,t;return null!==(e=null===(t=this._editGeometry.parts[0])||void 0===t?void 0:t.isClosed())&&void 0!==e&&e}get firstPoint(){if(this.constructed){var e;const{coordinateHelper:t,parts:i}=this._editGeometry,s=null===(e=i[0])||void 0===e?void 0:e.getFirstVertex();if(null!=s)return t.vectorToPoint(s.pos)}return null}get lastPoint(){if(this.constructed){var e;const{coordinateHelper:t,parts:i}=this._editGeometry,s=null===(e=i[0])||void 0===e?void 0:e.getLastVertex();if(null!=s)return t.vectorToPoint(s.pos)}return null}getVertex(e){var t;if(!this.constructed||null===(t=this._editGeometry.parts[0])||void 0===t||!t.vertices.length)return null;const i=this._editGeometry.parts[0].vertices[0];let s=i;do{if(s.index===e)return s;s=s.rightSegment.rightVertex}while(s!==i&&null!=s);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.vectorToPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.vectorToPoint(this.getVertex(e).pos)}forEachVertex(e){if(this.constructed&&this._editGeometry.parts.length>0)for(const t of this._editGeometry.parts[0].iterateVertices())e(t,t.index)}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex((i,s)=>{t.vectorToPoint(i.pos,$),e($,s)})}clear(){null!=this.areaMeasurement&&(this.areaMeasurement.geometry=null)}add(e){if(!this.constructed)return null;const t=this._editGeometryOperations.appendVertex(this._editGeometry.coordinateHelper.pointToVector(e),this._editGeometry.parts.at(0));return this.emit("change"),t}close(){if(!this.constructed||0===this._editGeometry.parts.length)return null;const e=this._editGeometryOperations.closePart(this._editGeometry.parts[0]);return this.emit("change"),e}ensureContains(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=!1;if(this._editGeometry.parts.forEach(t=>{for(const s of t.iterateVertices())s===e&&(i=!0)}),!i)throw new Error("vertex doesn't exist ".concat(t));return i}setVertexPosition(e,t){if(!this.constructed)return null;const i=this._editGeometryOperations.setVertexPosition(e,this._editGeometry.coordinateHelper.pointToVector(t));return this.emit("change"),i}equals(e){if(this.numVertices!==e.numVertices)return!1;let t=!0;return this.forEachVertexPosition((i,s)=>{const n=e.getVertexPositionAsPointFromIndex(s);i.equals(n)||(t=!1)}),!!t}};(0,s.Cg)([(0,r.MZ)({value:null})],J.prototype,"areaMeasurement",null),(0,s.Cg)([(0,r.MZ)({value:null})],J.prototype,"view",null),(0,s.Cg)([(0,r.MZ)()],J.prototype,"isEmptyPolygon",null),(0,s.Cg)([(0,r.MZ)()],J.prototype,"isValidPolygon",null),(0,s.Cg)([(0,r.MZ)()],J.prototype,"extent",null),(0,s.Cg)([(0,r.MZ)()],J.prototype,"spatialReference",null),(0,s.Cg)([(0,r.MZ)()],J.prototype,"numVertices",null),(0,s.Cg)([(0,r.MZ)()],J.prototype,"polygonIsClosed",null),J=(0,s.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementPathHelper")],J);const $=new B.A;var K=i(89379),X=(i(11265),i(59784)),Y=i(11113),ee=i(34761),te=i(13191);function ie(e,t){return(0,c.kM)(e,(0,g.cT)(e.value,e.unit,t))}function se(e,t){return(0,c.kM)(e,ne(e,t))}function ne(e,t){const i=function(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-nautical-miles":return"nautical-miles";case"square-us-feet":return"us-feet";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";case"square-meters":return"meters";case"square-kilometers":return"kilometers"}throw new Error("unhandled area unit")}(t);return(0,g.Vs)(e.value,e.unit,i)}var re=i(66747),ae=i(7256),oe=i(43047),le=i(32314),he=i(50468),de=i(17345),ue=i(34981),pe=i(59696),ce=i(45463),ge=i(82809),me=i(86401),_e=i(63928),ve=i(16506),ye=i(59246),we=i(60322),fe=i(87230),Me=i(57162);class Ce extends ye.w{constructor(e,t){super(e,t,new ve.$(fe.C,()=>i.e(62028).then(i.bind(i,62028))),me.l5.locations)}initializePipeline(e){const{oitPass:t,transparent:i,polygonOffset:s,output:n}=e,r=0===t,a=2===t;return(0,Me.Ey)({blending:i?(0,we.Yf)(t):null,depthTest:{func:(0,we.K_)(t)},depthWrite:(0,we.z5)(e),drawBuffers:(0,we.m6)(t,n),colorWrite:Me.kn,polygonOffset:r||a?s?Pe:null:{factor:-1,units:-25}})}}const Pe={factor:0,units:-25};var Ve=i(6485),Se=i(92656);class Le extends Se.E{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.polygonOffset=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=0,this.emissionSource=0,this.output=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.overlayEnabled=!1,this.draped=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent&&this.writeDepth}}(0,s.Cg)([(0,Ve.W)()],Le.prototype,"transparent",void 0),(0,s.Cg)([(0,Ve.W)()],Le.prototype,"writeDepth",void 0),(0,s.Cg)([(0,Ve.W)()],Le.prototype,"polygonOffset",void 0),(0,s.Cg)([(0,Ve.W)()],Le.prototype,"terrainDepthTest",void 0),(0,s.Cg)([(0,Ve.W)()],Le.prototype,"cullAboveTerrain",void 0);var be=i(75569);class De extends _e.W{constructor(e){super(e,Ae),this._configuration=new Le,this.produces=new Map([[2,e=>(0,ue.RN)(e)&&!this.transparent],[4,e=>(0,ue.RN)(e)&&this.transparent&&this.parameters.writeDepth],[8,e=>(0,ue.RN)(e)&&this.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.transparent=this.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color1[3]>=be.Q||this.parameters.color2[3]>=be.Q}get transparent(){return this.parameters.color1[3]<1||this.parameters.color2[3]<1}createGLMaterial(e){return new xe(e)}createBufferWriter(){return new ge.Z(me.l5)}}class xe extends pe.A{beginSlot(e){return this.getTechnique(Ce,e)}}class Ae extends ce.q{constructor(){super(...arguments),this.size=(0,_.fA)(1,1),this.color1=(0,w.fA)(.75,.75,.75,1),this.color2=(0,w.fA)(.5,.5,.5,1),this.writeDepth=!0,this.polygonOffset=!1}}class Re extends le.X{constructor(e){super(e),this._checkerBoardMaterial=null,this._renderOccluded=4,this._geometry=null,this._size=(0,_.fA)(1,1),this._color1=(0,w.fA)(1,.5,0,.5),this._color2=(0,w.fA)(1,1,1,.5),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){(0,m.C)(this._size,e),this._updateMaterial()}get color1(){return this._color1}set color1(e){(0,oe.a)(e,this._color1)||((0,oe.d)(this._color1,e),this._updateMaterial())}get color2(){return this._color2}set color2(e){(0,oe.a)(e,this._color2)||((0,oe.d)(this._color2,e),this._updateMaterial())}_updateMaterial(){var e;null===(e=this._checkerBoardMaterial)||void 0===e||e.setParameters({size:this._size,color1:this._color1,color2:this._color2,renderOccluded:this._renderOccluded})}createExternalResources(){this._checkerBoardMaterial=new De({size:this._size,color1:this._color1,color2:this._color2,writeDepth:!1,polygonOffset:!0,renderOccluded:4,isDecoration:this.isDecoration})}destroyExternalResources(){this._checkerBoardMaterial=null}forEachMaterial(e){e(this._checkerBoardMaterial)}createGeometries(e){if(null==this._geometry||null==this._checkerBoardMaterial)return;const t=Oe;(0,ee.sC)(t,this.transform);const i=this._geometry,s=[],n=(0,y.vt)();i.position.forEach(e=>{(0,v.e)(n,e,t),s.push(n[0],n[1],n[2])});const r=[];i.uv.forEach(e=>{r.push(e[0],e[1])});const a=new de.V(this._checkerBoardMaterial,[["position",new he.n(s,i.triangleIndices,3,!0)],["uv0",new he.n(r,i.triangleIndices,2,!0)]]);e.addGeometry(a)}}const Oe=(0,y.vt)();var Ze=i(25191),ze=i(35925),Ge=i(38042),ke=i(63860);let Ie=class extends d.A{get _parameters(){const{accentColor:e,textColor:t}=this.view.effectiveTheme,i=(0,X.QP)(e),s=(0,X.f6)(e,.5),n=(0,X.f6)((0,X.bJ)(e),.5),r=(0,X.bJ)(t,160);return{accentColor:i,transparentAccentColor:s,transparentContrastColor:n,intersectingLineColor:[1,.2,0,1],textColor:t,textBackgroundColor:(0,X._L)(r,.6),textCalloutColor:(0,X._L)(r,.5),pathLineWidth:3,perimeterLineWidth:2,projectionLineWidth:2,projectionLineStippleSize:5,labelDistance:25}}get visible(){return this.analysisViewData.visible}get _renderUnits(){var e;const t=this.view.renderCoordsHelper.spatialReference;return null!==(e=(0,g._H)(t))&&void 0!==e?e:"meters"}get testData(){}constructor(e){super(e),this._path=null,this._intersectedPath=null,this._perimeter=null,this._intersectedPerimeter=null,this._projectionLines=null,this._measurementArea=null,this._areaLabel=null,this._perimeterLengthLabel=null,this._pathSegments=[],this._perimeterSegments=[],this._origin=(0,y.vt)(),this._originTransform=(0,te.vt)(),this.messages=null,this.viewData=He,this.areaLabel=null,this.perimeterLengthLabel=null,this.loadingMessages=!0}initialize(){const{analysisViewData:e,_parameters:t,view:i}=this;this._path=new ae.t({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._intersectedPath=new ae.t({view:i,attached:!0,width:t.pathLineWidth,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._perimeter=new ae.t({view:i,attached:!0,width:t.perimeterLineWidth,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._intersectedPerimeter=new ae.t({view:i,attached:!0,width:t.perimeterLineWidth,color:t.intersectingLineColor,polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._projectionLines=new ae.t({view:i,attached:!0,width:t.projectionLineWidth,stipplePattern:(0,ze.wk)(t.projectionLineStippleSize),polygonOffset:!0,renderOccluded:4,isDecoration:!0}),this._measurementArea=new Re({view:i,attached:!0,isDecoration:!0});const s={attached:!0,view:i,isDecoration:!0};this._areaLabel=new re.N((0,K.A)((0,K.A)({},s),{},{fontSize:16})),this._perimeterLengthLabel=new re.N((0,K.A)((0,K.A)({},s),{},{fontSize:12})),this.addHandles([(0,u.wB)(()=>[e.mode,this.visible,e.unit,e.measurementData,e.stagedPoint],()=>this._update(),u.pc),(0,u.wB)(()=>{var e;return null===(e=i.state)||void 0===e?void 0:e.camera},()=>this._updateLabels(),u.pc),(0,Ge.oQ)(()=>this._updateMessageBundle()),(0,u.wB)(()=>this._parameters,e=>{let{accentColor:t,transparentAccentColor:i,transparentContrastColor:s,textColor:n,textBackgroundColor:r,textCalloutColor:a}=e;const{_path:o,_intersectedPath:l,_perimeter:h,_projectionLines:d,_measurementArea:u,_areaLabel:p,_perimeterLengthLabel:c}=this;o.color=t,l.color=t,h.color=t,d.color=t,u.color1=i,u.color2=s,p.textColor=n,p.backgroundColor=r,p.calloutColor=a,c.textColor=n,c.backgroundColor=r,c.calloutColor=a},u.Vh)]),this._updateMessageBundle()}destroy(){this._measurementArea=(0,n.pR)(this._measurementArea),this._path=(0,n.pR)(this._path),this._intersectedPath=(0,n.pR)(this._intersectedPath),this._perimeter=(0,n.pR)(this._perimeter),this._intersectedPerimeter=(0,n.pR)(this._intersectedPerimeter),this._areaLabel=(0,n.pR)(this._areaLabel),this._perimeterLengthLabel=(0,n.pR)(this._perimeterLengthLabel),this._projectionLines=(0,n.pR)(this._projectionLines),this.set("view",null)}_update(){if(this.destroyed||!this.view.ready||!this.view.renderCoordsHelper)return;const{analysisViewData:{measurementData:e},analysisViewData:t}=this;null!=e&&(this._updateViewData(e,t.path),this._updateOrigin(),this._updatePathSegments(),this._updatePerimeterSegments(),this._updateArea(),this._updateProjectionLines(),this._updateLabels())}_updateViewData(e,t){const i=e.validMeasurement,s="geodesic"===e.actualMeasurementMode,n=s?e.geodesicArea:e.area;let r=1;if(n){const e=ie(n,this.analysisViewData.unit);r=(0,p.Vr)(Math.sqrt(e.value)/Math.sqrt(300)),r*=Math.sqrt((0,g.oU)(1,e.unit,"square-meters")),r=(0,g.oU)(r,"meters",this._renderUnits)}const a={validMeasurement:i,numVertices:e.numVertices,hasStagedVertex:e.hasStagedVertex,path:t,mode:e.actualMeasurementMode,positionsRender:e.positionsRender,positionsFittedWorld:e.positionsFittedWorld,positionsFittedRender:e.positionsFittedRender,intersectingSegments:s?e.geodesicIntersectingSegments:e.intersectingSegments,triangleIndices:s?e.geodesicTriangleIndices:e.triangleIndices,areaCentroid:s?e.geodesicAreaCentroidRenderCoords:e.areaCentroidRenderCoords,perimeterLengthLabelSegmentIndex:0,area:s?e.geodesicArea:e.area,pathLength:s?e.geodesicPathLength:e.pathLength,perimeterLength:e.perimeterLength,checkerSize:r};this._set("viewData",a)}_updateOrigin(){const e=this.viewData;(0,z.ix)(e.positionsRender,this._origin),(0,ee.kN)(this._originTransform,this._origin),this._measurementArea.transform=this._originTransform,this._projectionLines.transform=this._originTransform}_createSegments(e){const t=this.viewData,i=this.view.renderCoordsHelper.spatialReference,s=t.mode,n=[],r=[],a=[],o=t.numVertices,l=t.validMeasurement?o:o-1;for(let d=0;d<l;++d){const l=t[e][d],h=t[e][(d+1)%o];let u=null;switch(s){case"euclidean":u=new Ze.C(l,h);break;case"geodesic":u=new Ze.J(l,h,i)}t.intersectingSegments.has(d)?a.push(u):r.push(u),n.push(u)}let h=null;return t.validMeasurement&&t.hasStagedVertex&&l>=2?h=n[n.length-2]:t.hasStagedVertex&&l>=1&&(h=n[n.length-1]),{all:n,nonIntersecting:r,intersecting:a,stagedSegment:h}}_updatePathSegments(){const{visible:e}=this,t=this._createSegments("positionsRender");this._path.setGeometryFromSegments(t.nonIntersecting,this._origin),this._path.visible=e,this._intersectedPath.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPath.visible=e,this._pathSegments=t.all}_updatePerimeterSegments(){const e=this.visible&&"euclidean"===this.viewData.mode&&this.viewData.path.numVertices>2,t=this._createSegments("positionsFittedRender");this._perimeter.setGeometryFromSegments(t.nonIntersecting,this._origin),this._perimeter.visible=e,this._intersectedPerimeter.setGeometryFromSegments(t.intersecting,this._origin),this._intersectedPerimeter.visible=e,this._perimeterSegments=t.all}_updateArea(){const e=this.viewData;switch(e.mode){case"euclidean":this._updateAreaEuclidean(e);break;case"geodesic":this._updateAreaGeodesic()}}_updateAreaEuclidean(e){const t=this.visible;e.validMeasurement&&0===e.intersectingSegments.size&&e.triangleIndices?(this._measurementArea.geometry={uv:e.positionsFittedWorld,position:e.positionsFittedRender,triangleIndices:e.triangleIndices},this._measurementArea.size=[e.checkerSize,e.checkerSize],this._measurementArea.visible=t):this._measurementArea.visible=!1}_updateAreaGeodesic(){this._measurementArea.visible=!1}_updateProjectionLines(){const e=this.viewData,t=this.visible,i=e.mode,s=e.numVertices;if(s>0&&e.validMeasurement&&"euclidean"===i){const i=[];for(let t=0;t<s;++t){const s=(0,y.vt)();(0,v.e)(s,e.positionsRender[t],this._origin);const n=(0,y.vt)();(0,v.e)(n,e.positionsFittedRender[t],this._origin),i.push([s,n])}this._projectionLines.geometry=i,this._projectionLines.visible=t}else this._projectionLines.geometry=null,this._projectionLines.visible=!1}_updateLabels(){if(this.destroyed)return;const{viewData:e}=this,{area:t,path:i}=e;if(!i)return;const s=this.visible,n=this._areaLabel,r=this._perimeterLengthLabel,a=e.validMeasurement;n.visible=!0,r.visible=!0;let o=!1;const l=function(e,t,i){return e&&t&&(0,Y.zJ)(e,t,(0,g.cT)(t.value,t.unit,i))}(this.messages,t,this.analysisViewData.unit);if(null!=l&&s&&(n.geometry={type:"point",point:e.areaCentroid},n.text=l,o=e.validMeasurement&&0===e.intersectingSegments.size),this._set("areaLabel",l),s&&a&&0===e.intersectingSegments.size){const t="geodesic"===e.mode,i=t?e.pathLength:e.perimeterLength,s=function(e,t,i){return e&&t&&(0,Y.zJ)(e,t,ne(t,i))}(this.messages,i,this.analysisViewData.unit);this._set("perimeterLengthLabel",s),r.distance=this._parameters.labelDistance,r.anchor="top",r.text=s;let n=!0;for(let a=0;a<e.numVertices;++a){const i=(e.perimeterLengthLabelSegmentIndex+a)%e.numVertices,s=t?this._pathSegments[i]:this._perimeterSegments[i];if(n=!0,r.geometry={type:"segment",segment:s,sampleLocation:"center"},!r.overlaps(this._areaLabel))break;n=!1}r.visible=n}else r.visible=!1;n.visible=o}_updateMessageBundle(){this.loadingMessages=!0,(0,ke.ud)("esri/core/t9n/Units").then(e=>{this.messages=e,this.view&&this._update()}).finally(()=>{this.loadingMessages=!1})}};(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"_parameters",null),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"view",void 0),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"messages",void 0),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"analysis",void 0),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"viewData",void 0),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"analysisViewData",void 0),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],Ie.prototype,"areaLabel",void 0),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],Ie.prototype,"perimeterLengthLabel",void 0),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"loadingMessages",void 0),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"visible",null),(0,s.Cg)([(0,r.MZ)()],Ie.prototype,"_renderUnits",null),Ie=(0,s.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurement.support.AreaMeasurementVisualization")],Ie);const He={validMeasurement:!1,numVertices:0,hasStagedVertex:!1,path:null,mode:null,positionsRender:null,positionsFittedWorld:null,positionsFittedRender:null,intersectingSegments:null,triangleIndices:null,areaCentroid:null,perimeterLengthLabelSegmentIndex:null,checkerSize:null,area:null,pathLength:null,perimeterLength:null};var Te=i(56002),Ee=i(50346),Fe=i(19451),We=i(32535),Be=i(70836),Ue=i(7947),qe=i(69539),je=i(88321),Ne=i(76931),Qe=i(56121),Je=i(38317),$e=i(91175);class Ke{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.screenPoint=e,this.result=t}}class Xe{constructor(e,t){this.scenePoint=e,this.mapPoint=t}}var Ye=i(1307),et=i(72017),tt=i(38386),it=i(46576);class st{constructor(e){this.vertexManipulators=[],this._destroyed=!1,this._isManipulatorsOwner=!0,this._visible=!0,this._listenerHandles=null,this._tempHandlePosition=(0,y.vt)();const{analysisViewData:t,manipulators:i,toolState:s,view:n,visible:r}=e;this._analysisViewData=t,this._toolState=s,null!=i?(this._manipulators=i,this._isManipulatorsOwner=!1):this._manipulators=new tt.t,this._view=n,this._intersector=(0,it.T)(n.state.viewingMode);const a=(0,Je.UM)(this._handleColor),o=[new $e.M((0,et.CM)(a,1,32,32))],l=new Qe.q({view:n,renderObjects:o});l.available=!1,l.radius=ot,l.interactive=!1,this._manipulators.add(l),this._cursorManipulator=l,this._cursorManipulatorMaterial=a,this._laserLine=new Ye.o({view:n,attached:!0,style:{glowWidth:nt,glowFalloff:rt,innerWidth:at},isDecoration:!0}),this._updateVisibility(null===r||void 0===r||r)}destroy(){this._listenerHandles=(0,n.pR)(this._listenerHandles),this._isManipulatorsOwner?this._manipulators=(0,n.pR)(this._manipulators):this._manipulators=null,this._laserLine=(0,n.pR)(this._laserLine),this._destroyed=!0}get destroyed(){return this._destroyed}get visible(){return this._visible}set visible(e){e?this.show():this.hide()}get testData(){}show(){this._setVisibility(!0)}hide(){this._setVisibility(!1)}_setVisibility(e){this._destroyed||this._visible===e||this._updateVisibility(e)}_updateVisibility(e){this._visible=e,this._laserLine.visible=e,e?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach(e=>{let{manipulator:t}=e;return this._removeVertexManipulator(t)}),this.vertexManipulators=[])}vertexHandleAt(e,t){const i=this._manipulators.intersect(e,t);return null===i||void 0===i?void 0:i.metadata}pick(e){const t=this._view.spatialReference,i=(0,Ne.WA)(e.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(i,this._intersector);const s=this._intersector.results.min,n=(0,y.vt)();if(!s.getIntersectionPoint(n))return null;const r=this._view.renderCoordsHelper.fromRenderCoords(n,new B.A({spatialReference:t}));return null==r?null:new Xe(n,r)}_updateAll(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())}_createVertexManipulator(){const e=(0,Je.UM)(this._handleColor),t=[new $e.M((0,et.CM)(e,1,32,32))],i=new Qe.q({view:this._view,renderObjects:t});return i.radius=ot,this._manipulators.add(i),{manipulator:i,material:e}}_removeVertexManipulator(e){this._manipulators.remove(e)}_updateVertexManipulators(){const{viewData:e}=this._analysisViewData,t=this._analysisViewData.path?this._analysisViewData.path.vertices:[],i=this.vertexManipulators;(function(e,t,i,s){for(;e.length<t;)e.push(i());if(s)for(;e.length>t;)s(e.pop());else e.length=t})(i,t.length,()=>this._createVertexManipulator(),e=>{let{manipulator:t}=e;return this._removeVertexManipulator(t)}),i.forEach((i,s)=>{let{manipulator:n}=i;n.metadata=t[s],n.renderLocation=e.positionsRender[s],n.cursor=0===s&&"drawing"===this._toolState.polygonState?"crosshair":null}),"drawing"===this._toolState.polygonState&&null!=this._analysisViewData.stagedPoint?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.stagedPoint):this._cursorManipulator.available=!1}get _handleColor(){return(0,X.f6)(this._view.effectiveTheme.accentColor,.5)}_getFocusPoint(){const{lastDraggedVertex:e}=this._analysisViewData;switch(this._toolState.polygonState){case"drawing":return null!=this._analysisViewData.stagedPoint?this._analysisViewData.stagedPoint:null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):this._analysisViewData.path.lastPoint;case"editing":return null!=e?this._analysisViewData.path.getVertexPositionAsPoint(e):null;default:return this._analysisViewData.stagedPoint}}_updateLaserLine(){const e="measured"!==this._toolState.polygonState&&this._toolState.active,t=this._getFocusPoint();if(e&&null!=t){const e=this._tempHandlePosition;this._view.renderCoordsHelper.toRenderCoords(t,e),this._laserLine.heightManifoldTarget=e}else this._laserLine.heightManifoldTarget=null}_initializeListeners(){this._listenerHandles=new je.A,this._listenerHandles.add([(0,u.wB)(()=>this._toolState.polygonState,()=>this._updateLaserLine()),(0,u.wB)(()=>this._analysisViewData.viewData,()=>this._updateAll(),u.OH),(0,u.wB)(()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.stagedPoint}),()=>this._updateLaserLine()),(0,u.wB)(()=>this._toolState.active,()=>this._updateAll()),(0,u.wB)(()=>this._view.effectiveTheme.accentColor,e=>{const t=(0,X.f6)(e,.5);for(const{material:o}of this.vertexManipulators)o.setParameters({color:t});this._cursorManipulatorMaterial.setParameters({color:t});const i=qe.A.toUnitRGB(e),s=qe.A.toUnitRGB((0,X.bJ)(e)),n=.75*e.a,r=this._laserLine,a=r.style;r.style=(0,K.A)((0,K.A)({},a),{},{glowColor:i,innerColor:s,globalAlpha:n})},{initial:!0,equals:X.hw})])}_destroyListeners(){this._listenerHandles=(0,n.pR)(this._listenerHandles)}}const nt=8,rt=8,at=1,ot=5;var lt=i(5109),ht=i(17046),dt=i(82307),ut=i(13284),pt=i(61237),ct=i(75218),gt=i(14318),mt=i(70330),_t=i(11500);let vt=class extends lt.k{constructor(e){super(e),this._updatingHandles=new Fe.U,this._snappingManagerResult=null,this.polygonState="initial",this.removeIncompleteOnCancel=!1,this.manipulators=new tt.t,this._getSnappingContext=(0,Te.B)(e=>new ut.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Q.p(new N.ZE("point",(0,j.BV)(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new Be.s}))}initialize(){const{view:e,analysisViewData:t,manipulators:i,visible:s}=this;this.measurementView=new st({view:e,analysisViewData:t,toolState:this,manipulators:i,visible:s}),this._snappingOperation=new gt.O({view:e}),this._updatingHandles.add(()=>this.stagedPoint,e=>{this.analysisViewData.stagedPoint=null!=e?(0,We.EL)(e,new B.A):null},u.pc),(0,mt.BY)(this,()=>{var e,t;const i=null!==(e=null===(t=this.view.inputManager.latestPointerInfo)||void 0===t?void 0:t.type)&&void 0!==e?e:"mouse",s=this._getSnappingContext(i);this._updatingHandles.addPromise((0,Ee.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._ensureSnappingManager(),s)))}),this._setupManipulators(),this.addHandles([(0,u.z7)(()=>"measured"===this.state,()=>this.finishToolCreation(),u.pc),this.analysisViewData.path.on("change",()=>{const e=this.analysisViewData.path;"initial"!==this.polygonState||e.isEmptyPolygon||(e.isValidPolygon?this.polygonState="measured":this.polygonState="drawing")})])}destroy(){this.measurementView.destroy(),this._set("measurementView",null),this._updatingHandles=(0,n.pR)(this._updatingHandles)}get _snappingManager(){var e;return null===(e=this._snappingManagerResult)||void 0===e?void 0:e.snappingManager}_ensureSnappingManager(){if(null==this._snappingManagerResult){const e=(0,ct.X)(this.view);this._snappingManagerResult=e,this.addHandles(e)}return this._snappingManagerResult.snappingManager}get state(){return 0===this.analysisViewData.path.numVertices?"ready":this.analysisViewData.path.isValidPolygon&&"editing"!==this.polygonState?"measured":"measuring"}get cursor(){return this.active?"crosshair":null}get updating(){var e;return this._updatingHandles.updating||!(null===(e=this._snappingManager)||void 0===e||!e.updating)}get stagedPoint(){return this._snappingOperation.stagedPoint}set stagedPoint(e){this._snappingOperation.stagedPoint=e}get snappingOptions(){var e;return null===(e=this._snappingManager)||void 0===e?void 0:e.options}finishMeasurement(){const{path:e}=this.analysisViewData;e.numVertices<=2||(e.close(),this.polygonState="measured",this._resetSnappingState(),this.active&&(this.view.activeTool=null))}resetCreated(){super.resetCreated(),this._resetSnappingState(),this.polygonState="initial","measured"===this.state&&(this.polygonState="measured",this.finishToolCreation())}onShow(){this.measurementView.show()}onHide(){this.measurementView.hide()}onDeactivate(){this._resetSnappingState()}onInputEvent(e){switch(e.type){case"immediate-double-click":this._handleImmediateDoubleClick(e);break;case"immediate-click":this._handleImmediateClick(e);break;case"pointer-move":this._handlePointerMove(e);break;case"drag":this._handleDrag(e);break;case"key-down":this._handleKeyDown(e)}}_setupManipulators(){const e=e=>e.events.on("grab-changed",()=>{if(this.analysisViewData.path.isValidPolygon){const e=this.manipulators.some(e=>e.manipulator.grabbing);this.polygonState=e?"editing":"measured"}}),t=t=>{this.addHandles([(0,ht.Xt)(t,(e,t,i,s)=>{const n=(0,Ue.z7)(e),r=e.metadata,a=this._snappingManager,o=this._getSnappingContext(s),l=this._updatingHandles,{snappingStep:h,cancelSnapping:d}=(0,pt.L)({snappingManager:a,snappingContext:o,updatingHandles:l});i=i.next(n).next(t=>(this.analysisViewData.lastDraggedVertex=null,this.analysisViewData.path.setVertexPosition(r,u),e.location=u,t)).next(d),t.next(n).next((0,Ue.xk)(this.view)).next(...h).next(t=>{e.location=t.mapEnd,this.analysisViewData.lastDraggedVertex="end"===t.action?null:r,this.analysisViewData.path.setVertexPosition(r,(0,We.EL)(t.mapEnd))});const u=(0,We.EL)(this.analysisViewData.path.getVertexPositionAsPoint(r))}),e(t)],t)};this.manipulators.forEach(e=>{let{manipulator:i}=e;t(i)}),this.addHandles([this.manipulators.on("after-add",e=>{let{item:{manipulator:i}}=e;t(i)}),this.manipulators.on("after-remove",e=>{let{item:{manipulator:t}}=e;return this.removeHandles(t)})])}_handleImmediateDoubleClick(e){(0,O.s7)(e)&&("drawing"===this.polygonState&&this.finishMeasurement(),e.stopPropagation())}_handleDrag(e){"editing"===this.polygonState&&e.stopPropagation()}_handleImmediateClick(e){if(!(0,O.s7)(e))return;const t=(0,_t.ZV)(e),{pointerType:i}=e;if(this.active)switch(this.polygonState){case"initial":case"measured":if(this._addVertexAt(t,i))return this.stagedPoint=null,this.polygonState="drawing",void e.stopPropagation();break;case"drawing":{const s=this.measurementView.vertexHandleAt(t,i);if(null==s){if(this._addVertexAt(t,i))return this.stagedPoint=null,void e.stopPropagation()}else 0===s.index&&(this.finishMeasurement(),e.stopPropagation());break}}"mouse"===e.pointerType&&this._hoverAt(t)}_handlePointerMove(e){if("mouse"===e.pointerType){const t=(0,_t.ZV)(e);this._hoverAt(t)}}_handleKeyDown(e){const{path:t}=this.analysisViewData;e.key===dt.NE.complete&&"drawing"===this.polygonState&&t.numVertices>=3&&(this.stagedPoint=null,this.finishMeasurement(),e.stopPropagation())}_hoverAt(e){const{polygonState:t}=this;if(this.active&&yt.has(t)){const t=this._pick(e);if(null!=(null===t||void 0===t?void 0:t.mapPoint)){const e=this._getSnappingContext("mouse");this._updatingHandles.addPromise((0,Ee.QZ)(this._snappingOperation.snap({point:t.mapPoint},this._ensureSnappingManager(),e)))}}else this.stagedPoint=null}_addVertexAt(e,t){const i=this._pick(e),s=null===i||void 0===i?void 0:i.mapPoint;if(null==s)return!1;this.analysis.valid&&"measured"===this.polygonState&&(this.analysis.clear(),this._set("created",!1),this.polygonState="initial");const n=this._getSnappingContext(t),r=this._snappingOperation.update({point:s},this._ensureSnappingManager(),n),a=(0,We.EL)(r,new B.A);return this.analysisViewData.path.add(a),!0}_pick(e){const t=new Ke(e);return this.measurementView.pick(t)}_resetSnappingState(){this._ensureSnappingManager().doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}get test(){}};(0,s.Cg)([(0,r.MZ)()],vt.prototype,"_snappingManagerResult",void 0),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"_snappingManager",null),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],vt.prototype,"state",null),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"polygonState",void 0),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],vt.prototype,"cursor",null),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"measurementView",void 0),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"removeIncompleteOnCancel",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],vt.prototype,"view",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],vt.prototype,"analysis",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0})],vt.prototype,"analysisViewData",void 0),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],vt.prototype,"manipulators",void 0),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"updating",null),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"stagedPoint",null),(0,s.Cg)([(0,r.MZ)()],vt.prototype,"snappingOptions",null),vt=(0,s.Cg)([(0,o.$)("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],vt);const yt=new Set(["initial","drawing","measured"]);var wt=i(10260),ft=i(66678),Mt=i(23739);let Ct=class extends h.P{constructor(e){super(e),this.type="area-measurement-view-3d",this.analysis=null,this.measurementData=null,this.lastDraggedVertex=null,this.stagedPoint=null,this.mode=0,this.tool=null,this.userOperation=null}initialize(){const{analysis:e,view:t}=this;this.path=new J({view:t,areaMeasurement:e}),this._analysisVisualization=new Ie({view:t,analysis:e,analysisViewData:this}),this.addResolvingPromise(Promise.all([(0,ft.c)(),(0,Mt.V)()]).then(i=>{let[s,n]=i;this.destroyed||(this._analysisController=new F({view:t,analysis:e,analysisViewData:this,geodesicAreaMeasurementUtils:s,geodesicLengthMeasurementUtils:n}))})),this.addHandles((0,wt.Hd)(this,vt))}destroy(){(0,wt.aS)(this),this.userOperation=(0,n.DC)(this.userOperation),this._analysisController=(0,n.pR)(this._analysisController),this._analysisVisualization=(0,n.pR)(this._analysisVisualization),this.path.destroy()}get visible(){return super.visible}set visible(e){super.visible=e}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get updating(){var e;return!(null===(e=this._analysisVisualization)||void 0===e||!e.loadingMessages)}get result(){const{measurementData:e}=this;if(null==e)return{area:null,mode:null,perimeter:null};const{unit:t}=this;if("euclidean"===e.actualMeasurementMode){const{area:i,perimeterLength:s}=e;return{area:null!=i?ie(i,t):null,perimeter:null!=s?se(s,t):null,mode:"euclidean"}}const{geodesicArea:i,pathLength:s}=e;return{area:null!=i?ie(i,t):null,perimeter:null!=s?se(s,t):null,mode:"geodesic"}}get viewData(){return this._analysisVisualization.viewData}get areaLabel(){return this._analysisVisualization.areaLabel}get perimeterLengthLabel(){return this._analysisVisualization.perimeterLengthLabel}get validMeasurement(){return this.path.isValidPolygon}get unit(){var e;return null!==(e=this.analysis.unit)&&void 0!==e?e:(0,l.c)(this.view)}get testData(){}place(e){return(0,wt.ZX)(this,{placementOptions:e})}};(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"_analysisVisualization",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"_analysisController",void 0),(0,s.Cg)([(0,r.MZ)({readOnly:!0})],Ct.prototype,"type",void 0),(0,s.Cg)([(0,r.MZ)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"analysis",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"updating",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"result",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"measurementData",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"viewData",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"areaLabel",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"perimeterLengthLabel",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"validMeasurement",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"path",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"lastDraggedVertex",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"stagedPoint",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"mode",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"unit",null),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"tool",void 0),(0,s.Cg)([(0,r.MZ)()],Ct.prototype,"userOperation",void 0),Ct=(0,s.Cg)([(0,o.$)("esri.views.3d.analysis.AreaMeasurementAnalysisView3D")],Ct);const Pt=Ct}}]);
//# sourceMappingURL=94089.aabaf67d.chunk.js.map